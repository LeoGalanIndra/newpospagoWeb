<div class="card">

  <div #modal></div>
  <div #sucessModal></div>

  <div class="card-body">
    <h5 class="card-title  text-center">
      Configuración Venta - Nuevo Pospago B2B
    </h5>

    <div>
      <div class="card">

        <div class="card-body">
          <h5 class="card-title  text-center">Cliente: {{ this.documentTypeParam }} - {{ this.documentNumberParam }} -
            {{
            this.legalNameParam }}</h5>

          <div class="container">
            <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item" role="presentation">
                <button #infoContrato class="nav-link active" id="info-contrato-tab" data-bs-toggle="tab"
                  data-bs-target="#info-contrato" type="button" role="tab" aria-controls="info-contrato"
                  aria-selected="true">Contrato</button>
              </li>
              <li class="nav-item" role="presentation">
                <button #infoOrdenServicio class="nav-link" id="orden-servicio-tab" data-bs-toggle="tab"
                  data-bs-target="#orden-servicio" type="button" role="tab" aria-controls="orden-servicio"
                  [disabled]="enabledPanels.ordenServicio">Ordenes
                  de Servicio</button>
              </li>
              <li class="nav-item" role="presentation">
                <button #infoCuentaFacturacion class="nav-link" id="cuenta-facturacion-tab" data-bs-toggle="tab"
                  data-bs-target="#cuenta-facturacion" type="button" role="tab" aria-controls="cuenta-facturacion"
                  [disabled]="enabledPanels.billAccount">Cuenta
                  Facturación</button>
              </li>
              <li class="nav-item" role="presentation">
                <button #infoProducto class="nav-link" id="producto-tab" data-bs-toggle="tab" data-bs-target="#producto"
                  type="button" role="tab" aria-controls="producto" aria-selected="false"
                  [disabled]="enabledPanels.product">Cargue Individual</button>
              </li>
              <li class="nav-item" role="presentation">
                <button #infoCargueMasivo class="nav-link" id="cargue-masivo-tab" data-bs-toggle="tab"
                  data-bs-target="#cargue-masivo" type="button" role="tab" aria-controls="cargue-masivo"
                  aria-selected="false" [disabled]="enabledPanels.massiveLoad">Cargue Masivo</button>
              </li>

              <li class="nav-item" role="presentation">
                <button #infoEquipos class="nav-link" id="registro-equipos-tab" data-bs-toggle="tab"
                  data-bs-target="#registro-equipos" type="button" role="tab" aria-controls="registro-equipos"
                  aria-selected="false" [disabled]="enabledPanels.devices">Equipos</button>
              </li>
              <li class="nav-item" role="presentation">
                <button #infoResumen class="nav-link" id="resumen-venta-tab" data-bs-toggle="tab"
                  data-bs-target="#resumen-venta" type="button" role="tab" aria-controls="resumen-venta"
                  aria-selected="false">Resumen</button>
              </li>
            </ul>
            <div class="tab-content" id="myTabContent">
              <div class="tab-pane fade show active" id="info-contrato" role="tabpanel"
                aria-labelledby="info-contrato-tab">
                <div class="card mt-1">
                  <form id="myCreateContractForm" (ngSubmit)="createModal(1)" #myCreateContractForm="ngForm">
                    <div class="card-header">
                      Información cliente asociado al contrato
                    </div>
                    <div class="card-body">
                      <div class="row g-1">
                        <div class="col-md-12">
                          <div class="p-2 border bg-light">
                            <div class="row g-1">
                              <!-- Fecha de Expedición Documento -->
                              <div *ngIf="this.documentTypeParam !== 'NIT' && documentTypeParam !== 'NE'"
                                class="col-md-4">
                                <label for="fechaExpedicion" class="form-label">Fecha Expedición documento</label>
                                <input type="date" class="form-control" id="newLineaFechaExpedicion"
                                  [(ngModel)]="newContract.contract.fechaExpedicion" name="newLineaFechaExpedicion">
                              </div>




                              <!-- Tipo de Identificación representante legal -->
                              <div *ngIf="this.documentTypeParam === 'NIT' || this.documentTypeParam === 'NE'"
                                class="col-md-4">
                                <label for="tipoIdentificacionRepresentanteLegal" class="form-label"
                                  style="font-size: small;">Tipo
                                  de
                                  Identificación
                                  Representante Legal</label>
                                <select class="form-select" id="newLineaRepresentanteLegalTipoIdentificacion"
                                  [(ngModel)]="newContract.contract.tipoDocumentoRepresentanteLegal"
                                  name="newLineaRepresentanteLegalTipoIdentificacion">
                                  <option selected disabled value="">Seleccione...
                                  </option>
                                  <option value="CC">CC</option>
                                  <option value="NIT">NIT</option>
                                  <option value="NE">NE</option>
                                  <option value="CE">CE</option>
                                  <option value="PP">PP</option>
                                  <option value="PEP">PEP</option>
                                </select>
                              </div>

                              <!-- Número Documento representante legal -->
                              <div *ngIf="this.documentTypeParam === 'NIT' || this.documentTypeParam === 'NE'"
                                class="col-md-4">
                                <label for="numeroDocumentoRepresentanteLegal" class="form-label"
                                  style="font-size: small;">Número
                                  Documento
                                  Representante Legal</label>
                                <input type="number" class="form-control" id="newLineanumeroDocumentoRepresentanteLegal"
                                  [(ngModel)]="newContract.contract.numeroDocumentoRepresentanteLegal"
                                  name="newLineanumeroDocumentoRepresentanteLegal">
                              </div>

                              <!-- Fecha de Expedición Documento representante legal -->
                              <div *ngIf="this.documentTypeParam === 'NIT' || this.documentTypeParam === 'NE'"
                                class="col-md-4">
                                <label for="fechaExpedicionRepresentanteLegal" class="form-label"
                                  style="font-size: small;">Fecha Expedición documento representante legal</label>
                                <input type="date" class="form-control" id="fechaExpedicionRepresentanteLegal"
                                  [(ngModel)]="newContract.contract.fechaExpedicionRepresentanteLegal"
                                  name="fechaExpedicionRepresentanteLegal">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="card-header">
                      Información de contrato
                    </div>
                    <div class="card-body">

                      <div class="row g-1">
                        <div class="col-md-12">
                          <div class="p-2 border bg-light">
                            <div class="row g-1">

                              <div class="col-md-4">
                                <label for="numeroContrato" class="form-label">Número
                                  Contrato</label>
                                <input type="text" class="form-control" id="numeroContrato"
                                  [(ngModel)]="newContract.contract.numeroContrato" name="numeroContrato">
                              </div>



                              <div class="col-md-4">
                                <label for="tipoContrato" class="form-label">Tipo
                                  Contrato</label>
                                <select class="form-select" id="tipoContrato"
                                  [(ngModel)]="newContract.contract.tipoContrato" name="tipoContrato">
                                  <option selected disabled value="">Seleccione...
                                  </option>
                                  <option value="Estandar">Contrato Estandar</option>
                                  <option value="Negociado">Contrato Negociado
                                  </option>
                                </select>
                              </div>

                              <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Estandar'">
                                <label for="inicioVigencia" class="form-label">Inicio de Vigencia</label>
                                <input type="date" class="form-control" id="inicioVigencia"
                                  [(ngModel)]="newServiceOrder.startDate" name="inicioVigencia"
                                  (ngModelChange)="calcularMesFinContrato()" />
                              </div>

                              <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Estandar'">
                                <label for="finVigencia" class="form-label">Fin de Vigencia</label>
                                <input type="text" class="form-control" id="finVigencia" readonly [value]="
                                    newServiceOrder.finVigencia
                                      | date : 'dd/MM/yyyy'
                                  " name="finVigencia" />
                              </div>

                              <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Estandar'">
                                <label for="sellerId" class="form-label">Cédula vendedor
                                </label>
                                <input type="number" class="form-control" id="sellerId"
                                [(ngModel)]="newServiceOrder.sellerId" name="sellerId" />
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                    </div>

                    <div class="card-footer text-end">
                      <div class="row">
                        <div class="col-9">
                          <div *ngIf="myCreateContractForm.invalid" class="alert alert-warning">
                            myCreateContractForm.errors

                          </div>
                        </div>
                        <div class="col-3">
                          <button type="submit" class="btn btn-success"
                            [disabled]="myCreateContractForm.invalid">SIGUIENTE</button>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>


              <div class="tab-pane fade" id="orden-servicio" role="tabpanel"
                aria-labelledby="orden-servicio-tab">

                <div class="card mt-1">

                  <form id="myCreateOrdenServicioForm" (ngSubmit)="createModal(7)" #myCreateOrdenServicioForm="ngForm">

                    <div class="card-header">
                      Ordenes de servicio para contrato negociado
                    </div>

                    <div class="card-body">

                      <div class="row g-1">
                        <div class="col-md-12">
                          <div class="p-2 border bg-light">
                            <div class="row g-1">

                              <div class="col-md-4">
                                <label for="serviceOrder" class="form-label">Orden de servicio
                                </label>
                                <input type="text" class="form-control" id="serviceOrder"
                                  [(ngModel)]="newServiceOrder.serviceOrder" name="serviceOrder" />
                              </div>

                              <div class="col-md-4">
                                <label for="inicioVigencia" class="form-label">Inicio de Vigencia</label>
                                <input type="date" class="form-control" id="inicioVigencia"
                                  [(ngModel)]="newServiceOrder.startDate" name="inicioVigencia"
                                  (ngModelChange)="calcularMesFinContrato()" />
                              </div>

                              <div class="col-md-4">
                                <label for="durationMonths" class="form-label">Meses de vigencia</label>
                                <input type="number" class="form-control" id="durationMonths"
                                  [(ngModel)]="newServiceOrder.durationMonths" name="durationMonths"
                                  (ngModelChange)="calcularMesFinContrato()" />
                              </div>

                              <div class="col-md-4">
                                <label for="finVigencia" class="form-label">Fin de Vigencia</label>
                                <input type="text" class="form-control" id="finVigencia" readonly [value]="
                                    newServiceOrder.finVigencia
                                      | date : 'dd/MM/yyyy'
                                  " name="finVigencia" />
                              </div>

                              <div class="col-md-3">
                                <label for="bagValue" class="form-label">Valor Bolsa</label>
                                <div class="input-group">
                                  <input type="text" class="form-control" id="bagValue"
                                    [(ngModel)]="newServiceOrder.bagValue" name="bagValue"
                                    (input)="onInput($event, 'bagValue')" (blur)="onBlur($event, 'bagValue')" />
                                </div>
                              </div>

                              <div class="col-md-3">
                                <label for="bagRedenption" class="form-label">Valor Redimido</label>
                                <div class="input-group">
                                  <input type="text" class="form-control" id="bagRedemption"
                                    [(ngModel)]="newServiceOrder.bagRedemption" name="bagRedemption" [value]="
                                      formatCurrency(
                                        newServiceOrder.bagRedemption
                                      )
                                    " (input)="onInput($event, 'bagRedemption')"
                                    (blur)="onBlur($event, 'bagRedemption')" />
                                </div>
                              </div>

                              <div class="col-md-4">
                                <label for="sellerId" class="form-label">Cédula vendedor
                                </label>
                                <input type="text" class="form-control" id="sellerId"
                                [(ngModel)]="newServiceOrder.sellerId" name="sellerId" />
                              </div>

                              <div class="col-md-3">
                                <label for="discountValue" class="form-label">Descuento Discontinuo</label>
                                <div class="input-group">
                                  <input type="number" class="form-control" id="discountValue"
                                    [(ngModel)]="newServiceOrder.discountValue" name="discountValue" min="0" max="100" />
                                  <span class="input-group-text">%</span>
                                </div>
                              </div>

                              <div class="col-md-6">
                                <label for="discountReasonId" class="form-label">Motivo del Descuento</label>
                                <select class="form-select" id="discountReasonId"
                                  [(ngModel)]="newServiceOrder.discountReasonId" name="discountReasonId">
                                  <option selected disabled value="">
                                    Seleccione...
                                  </option>
                                  <option value="motivo1">
                                    Descuento Comercial
                                  </option>
                                  <option value="motivo2">
                                    Descuento por Retención
                                  </option>
                                  <option value="motivo3">
                                    Descuento por renovación comercial
                                  </option>
                                </select>
                              </div>



                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card-header">Descuento Discontinuo</div>

                    <div class="card-body">
                      <div class="col-md-12">
                        <div class="p-2 border bg-light">
                          <div class="row g-1">
                            <div class="col-md-6">
                              <span>Meses descuento</span>
                              <ul class="list-group list-group-horizontal">
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox1"
                                    (change)="toggleMonth('ENE')" [checked]="
                                      newContract.discount.meses.includes('ENE')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox1">ENE</label>
                                </li>
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox2"
                                    (change)="toggleMonth('FEB')" [checked]="
                                      newContract.discount.meses.includes('FEB')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox2">FEB</label>
                                </li>
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox3"
                                    (change)="toggleMonth('MAR')" [checked]="
                                      newContract.discount.meses.includes('MAR')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox3">MAR</label>
                                </li>
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox4"
                                    (change)="toggleMonth('ABR')" [checked]="
                                      newContract.discount.meses.includes('ABR')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox4">ABR</label>
                                </li>
                              </ul>

                              <ul class="list-group list-group-horizontal">
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox5"
                                    (change)="toggleMonth('MAY')" [checked]="
                                      newContract.discount.meses.includes('MAY')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox5">MAY</label>
                                </li>
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox6"
                                    (change)="toggleMonth('JUN')" [checked]="
                                      newContract.discount.meses.includes('JUN')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox6">JUN</label>
                                </li>
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox7"
                                    (change)="toggleMonth('JUL')" [checked]="
                                      newContract.discount.meses.includes('JUL')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox7">JUL</label>
                                </li>
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox8"
                                    (change)="toggleMonth('AGO')" [checked]="
                                      newContract.discount.meses.includes('AGO')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox8">AGO</label>
                                </li>
                              </ul>

                              <ul class="list-group list-group-horizontal">
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox9"
                                    (change)="toggleMonth('SEP')" [checked]="
                                      newContract.discount.meses.includes('SEP')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox9">SEP</label>
                                </li>
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox10"
                                    (change)="toggleMonth('OCT')" [checked]="
                                      newContract.discount.meses.includes('OCT')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox10">OCT</label>
                                </li>
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox11"
                                    (change)="toggleMonth('NOV')" [checked]="
                                      newContract.discount.meses.includes('NOV')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox11">NOV</label>
                                </li>
                                <li class="list-group-item">
                                  <input class="form-check-input" type="checkbox" id="inlineCheckbox12"
                                    (change)="toggleMonth('DIC')" [checked]="
                                      newContract.discount.meses.includes('DIC')
                                    " />
                                  <label class="form-check-label" for="inlineCheckbox12">DIC</label>
                                </li>
                              </ul>
                            </div>

                            <div class="col-md-6">
                              <label for="anioDescuento" class="form-label">Años descuento</label>
                              <select class="form-select" id="anioDescuento" [(ngModel)]="newContract.discount.anio"
                                name="anioDescuento">
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                                <option value="2028">2028</option>
                                <option value="2029">2029</option>
                                <option value="2030">2030</option>
                              </select>
                            </div>

                            <a *ngIf="
                                newContract.discount.meses.length > 0 &&
                                newContract.discount.anio
                              " href="javascript:void(0);" class="btn btn-success" (click)="aceptarFechas()">Aceptar
                              meses y año descuento</a>

                            <div *ngIf="newContract.discount.mesesAnio!.length > 0">
                              <p>
                                <strong>Meses y años de descuento aplicados:
                                  <p></p>
                                </strong>
                              </p>
                              <p>
                                {{ newContract.discount.mesesAnio!.join(", ") }}
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="card-body"></div>
                      <div class="card-footer text-end">
                        <div class="row">
                          <div class="col-9">
                            <div *ngIf="myBillAccountForm.invalid" class="alert alert-warning">
                              myBillAccountForm.errors

                            </div>
                          </div>

                          <div class="col-3">
                            <button type="submit" class="btn btn-success"
                              [disabled]="myBillAccountForm.invalid">SIGUIENTE</button>
                          </div>

                        </div>
                      </div>
                    </div>

                  </form>

                </div>
              </div>

              <div class="tab-pane fade" id="cuenta-facturacion" role="tabpanel"
                aria-labelledby="cuenta-facturacion-tab">
                <div class="card mt-2">
                  <form id="myBillAccountForm" (ngSubmit)="createModal(2)" #myBillAccountForm="ngForm">

                    <div class="card-header">
                      Cuenta de Facturación
                    </div>
                    <div class="card-body">
                      <div class="row g-2">
                        <div class="col-12" *ngIf="newContract.billAccounts.length>0">
                          <div class="table-responsive">
                            <table class="table table-striped table-hover">
                              <thead>
                                <tr>
                                  <th scope="col">Seleccione cuenta</th>
                                  <th scope="col"># Cuenta Facturación</th>
                                  <th scope="col">Ciclo de Facturación</th>
                                  <th scope="col">Fecha de creación</th>
                                  <th scope="col"></th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr *ngFor="let cuenta of newContract.billAccounts; let i = index">
                                  <td>
                                    <input type="radio" name="selectedAccount" [value]="cuenta"
                                      [(ngModel)]="selectedBillAccount" (change)="selectAccount(cuenta)">
                                  </td>
                                  <td>{{ cuenta.cuentaFacturacion ?
                                    cuenta.cuentaFacturacion : "PENDIENTE" }}</td>
                                  <td>{{ cuenta.cicloFacturacion ?
                                    cuenta.cicloFacturacion : "PENDIENTE" }}</td>
                                  <td>{{ cuenta.fechaCreacion ? ( cuenta.fechaCreacion
                                    | date: 'dd/MM/yyyy' ) :
                                    "PENDIENTE" }}</td>
                                  <td><button type="button" class="btn btn-danger btn-sm"
                                      (click)="eliminarCuenta(i)">Eliminar</button>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                        <div class="col-12 text-end">
                          <button type="button" class="btn btn-primary" id="adicionarCuentaButton"
                            (click)="adicionarCuenta()">Adicionar
                            Cuenta Facturación</button>

                        </div>
                      </div>
                    </div>
                    <div class="card-footer text-end">
                      <div class="row">
                        <div class="col-9">
                          <div *ngIf="myBillAccountForm.invalid" class="alert alert-warning">
                            myBillAccountForm.errors

                          </div>
                        </div>

                        <div class="col-3">
                          <button type="submit" class="btn btn-success"
                            [disabled]="myBillAccountForm.invalid">SIGUIENTE</button>
                        </div>

                      </div>
                    </div>
                  </form>
                </div>
              </div>



              <div class="tab-pane fade" id="cargue-masivo" role="tabpanel" aria-labelledby="cargue-masivo-tab">
                <div class="card mt-1">
                  <form id="myMassiveLoadForm" (ngSubmit)="createModal(3)" #myMassiveLoadForm="ngForm">



                    <div class="card-header">
                      Cargue Masivo
                    </div>
                    <div class="card-body">
                      <div class="row g-1 mt-1">
                        <div class="col-md-8">
                          <input type="file" class="form-control" id="fileInput" (change)="onFileChange($event)">
                        </div>
                        <div class="col-md-4">
                          <button class="btn btn-primary" type="button" (click)="uploadFile()"
                            id="idCargueArchivoButton">Cargar
                            Archivo</button>
                        </div>

                        <div class="col-md-12">
                          <div class="alert alert-success">
                            <div class="row">
                              <div class="col-8"><b>Total de registros procesados:</b>
                              </div>
                              <div class="col-4">0</div>
                            </div>
                            <div class="row">
                              <div class="col-8"><b>Registros cargados exitosamente:</b>
                              </div>
                              <div class="col-4">0</div>
                            </div>
                            <div class="row">
                              <div class="col-8"><b>Registros con fallo:</b></div>
                              <div class="col-4">0</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="card-footer text-end">
                      <div class="row">
                        <div class="col-9">
                          <div *ngIf="myMassiveLoadForm.invalid" class="alert alert-warning">
                            myMassiveLoadForm.errors
                          </div>


                        </div>

                        <div class="col-3">
                          <button type="submit" class="btn btn-success"
                            [disabled]="myMassiveLoadForm.invalid">SIGUIENTE</button>
                        </div>

                      </div>

                    </div>
                  </form>
                </div>
              </div>

              <div class="tab-pane fade" id="producto" role="tabpanel" aria-labelledby="producto-tab">
                <div class="card mt-2">
                  <div class="card-header">
                    Configuración del producto.
                  </div>
                  <div class="card-body">
                    <h5 class="card-title text-center">Cuenta de facturacion: {{
                      selectedBillAccount.cuentaFacturacion }}</h5>


                    <form class="row g-2" id="myProductSetUpForm" (ngSubmit)="agregarPlan()"
                      #myProductSetUpForm="ngForm">

                      <div class="col-12">
                        <div class="p-3 border bg-light">
                          <div class="row g-3">
                            <div class="col-md-3">
                              <label for="tipoProducto" class="form-label">Tipo de
                                Línea</label>
                              <select class="form-select" id="tipoProducto" [(ngModel)]="newPlan.tipoProducto"
                                name="tipoProducto">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option value="tipo1">Estandar</option>
                                <option value="tipo2">Avanzado</option>
                              </select>
                            </div>
                            <div class="col-md-3">
                              <label for="familia" class="form-label">Familia</label>
                              <select class="form-select" id="familia" [(ngModel)]="newPlan.familia" name="familia">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option value="familia1">Movil</option>
                                <option value="familia2">IoT</option>
                              </select>
                            </div>
                            <div class="col-md-3">
                              <label for="producto" class="form-label">Tipo de
                                Producto</label>
                              <select class="form-select" id="producto" [(ngModel)]="newPlan.producto" name="producto">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option value="producto1">Pospago Empresarial
                                </option>
                              </select>
                            </div>
                            <div class="col-md-3">
                              <label for="plan" class="form-label">Plan</label>
                              <select class="form-select" id="plan" [(ngModel)]="newPlan.plan" name="plan"
                                (change)="updateValorUnitario()">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option *ngFor="let plan of planKeys" [value]="plan">{{ plan }}</option>
                              </select>
                            </div>
                            <div class="col-md-3">
                              <label for="cantidad" class="form-label">Cantidad</label>
                              <input type="number" class="form-control" id="cantidad" [(ngModel)]="newPlan.cantidad"
                                name="cantidad">
                            </div>
                            <div class="col-md-3">
                              <label for="valorUnitario" class="form-label">Valor Unitario (Sin IVA)</label>
                              <div class="input-group">

                                <input type="text" class="form-control" id="valorUnitario"
                                  [(ngModel)]="newPlan.valorUnitario" name="valorUnitario"
                                  [value]="formatCurrency(newPlan.valorUnitario)"
                                  (input)="onInput($event,'valorUnitario')" (blur)="onBlur($event,'valorUnitario')">
                              </div>
                            </div>

                            <!-- Tipo de Envío -->
                            <div class="col-md-3">
                              <label for="tipoEnvio" class="form-label">Tipo de
                                Envío</label>
                              <select class="form-select" id="newLineaTipoEnvio" [(ngModel)]="newPlan.tipoEnvio"
                                name="newLineaTipoEnvio">
                                <option selected disabled value="SIN OPERADOR">
                                  Seleccione...
                                </option>
                                <option value="OPERADOR LOGÍSTICO">OPERADOR
                                  LOGÍSTICO
                                </option>
                                <option value="ENTREGA POR COMERCIAL">ENTREGA POR
                                  COMERCIAL
                                </option>
                              </select>
                            </div>

                            <div class="col-md-4">
                              <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="servicioVozAplica"
                                  [(ngModel)]="aplicaVozAndSMS" name="servicioVozAplica" (change)="activarVozAndSMS()">
                                <label for="servicioVozAplica" class="form-check-label">Aplica Servicio
                                  Voz/SMS</label>
                              </div>
                            </div>

                            <div class="col-md-8" *ngIf="aplicaVozAndSMS">

                              Cargo Básico Servicio Voz/SMS <b>${{ aplicaVozAndSMS ?
                                vozAndSMSService.cargoBasico : 0 | currency }}</b>

                            </div>



                          </div>
                        </div>
                      </div>

                      <div class="col-12">
                        <div class="p-3 border bg-light">
                          <div class="row g-3">

                            <div class="col-md-4">
                              <label for="codigoPromocion" class="form-label">Descuento
                                Campaña</label>
                              <select class="form-select" id="codigoPromocion" [(ngModel)]="newPlan.idPromocion"
                                name="codigoPromocion">
                                <option selected value="Sin campaña">Sin campaña
                                </option>
                                <option value="Amor y Amistad">Amor y Amistad
                                </option>
                                <option value="Navidad">Navidad
                                </option>
                                <option value="Mes de la madre">Mes de la madre</option>
                              </select>

                            </div>

                            <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Negociado'">
                              <label for="valorDescuento" class="form-label">Descuento Personalizado</label>
                              <div class="input-group">
                                <input type="number" class="form-control" id="valorDescuento"
                                  [(ngModel)]="newPlan.valorDescuento" name="valorDescuento" step="0.01">
                                <span class="input-group-text">%</span>
                              </div>

                            </div>
                            <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Negociado'">
                              <label for="motivoDescuento" class="form-label">Motivo
                                del Descuento</label>
                              <select class="form-select" id="motivoDescuento" [(ngModel)]="newPlan.motivoDescuento"
                                name="motivoDescuento">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option value="motivo1">Descuento Comercial
                                </option>
                                <option value="motivo2">Descuento por Retención
                                </option>
                                <option value="motivo3">Descuento por renovacion
                                  comercial</option>
                              </select>
                            </div>


                          </div>
                        </div>
                      </div>



                      <div class="col-12">
                        <div class="p-3 border bg-light">
                          <div class="row g-3">

                            <div class="col-3">

                            </div>

                            <div class="col-6">
                              <h5 class="text-end" *ngIf="newPlan.cantidad >0 && newPlan.valorUnitario>0 ">
                                Valor Total sin Impuesto $ {{
                                newPlan.cantidad * ( newPlan.valorUnitario +
                                calcularTotalCargosServiciosAdicionales() ) | number:'1.2-2' }}</h5>
                            </div>

                            <div class="col-md-3 text-end">
                              <button type="submit" class="btn btn-primary" id="adicionarPlanButton">Adicionar
                                Producto</button>
                            </div>


                          </div>
                        </div>
                      </div>

                      <div class="col-12">
                        <div class="p-3 border bg-light">
                          <div class="row g-3">

                            <div class="table-responsive">
                              <table class="table table-striped table-hover">
                                <thead>
                                  <tr>
                                    <th scope="col">Seleccione Plan</th>
                                    <th scope="col">Plan</th>
                                    <th scope="col">Cantidad</th>
                                    <th scope="col"></th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr *ngFor="let plan of showedPlans; ; let j = index">

                                    <td>

                                      <input type="radio" name="selectPlan" [value]="(j + 1)"
                                        [(ngModel)]="selectedPlanId" (change)="selectPlan(j + 1)">

                                    </td>

                                    <td>{{ plan.plan }}</td>
                                    <td>{{ plan.cantidad }}</td>
                                    <td>
                                      <button class="btn btn-danger btn-sm" type="button" id="eliminarPlanButton"
                                        (click)="eliminarPlan(j)">Eliminar</button>

                                    </td>
                                  </tr>

                                </tbody>
                              </table>
                            </div>

                          </div>
                        </div>
                      </div>

                    </form>

                    <form class="row g-2 mt-1" id="myLineSetUpForm" (ngSubmit)="adicionarLinea()"
                      #myLineSetUpForm="ngForm">

                      <div class="col-12">
                        <div class="p-3 border bg-light">
                          <div class="row g-3">
                            <!-- Tipo Línea -->
                            <div class="col-md-3">
                              <label for="tipoLinea" class="form-label">Línea</label>
                              <select class="form-select" [(ngModel)]="newLinea.tipoLinea" name="newLineaTipoLinea">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option value="Linea Nueva">Linea Nueva</option>
                                <option value="Prepago a Pospago">Prepago a Pospago
                                </option>
                                <option value="Portabilidad">Portabilidad</option>
                                <option value="Portabilidad Con Cesión De Contrato">
                                  Portabilidad
                                  Con Cesión De Contrato</option>
                              </select>
                            </div>
                            <!-- Línea -->
                            <div class="col-md-3">
                              <label for="linea" class="form-label">MSISDN</label>
                              <input type="number" class="form-control" id="newLineaNumeroLinea"
                                [(ngModel)]="newLinea.numeroLinea" name="newLineaNumeroLinea">
                            </div>

                            <!-- IMSI -->
                            <div class="col-md-3">
                              <label for="imsi" class="form-label">IMSI</label>
                              <input type="number" class="form-control" id="newLineaImsi" [(ngModel)]="newLinea.imsi"
                                name="newLineaImsi">
                            </div>

                            <!-- IMEI -->
                            <div
                              *ngIf="newLinea.tipoLinea === 'Linea Nueva' || newLinea.tipoLinea === 'Prepago a Pospago'"
                              class="col-md-3">
                              <label for="imei" class="form-label">IMEI</label>
                              <input type="number" class="form-control" id="newLineaImei" [(ngModel)]="newLinea.imei"
                                name="newLineaImei">
                            </div>

                            <div class="col-md-4">
                              <label for="grupo" class="form-label">Grupo</label>
                              <select class="form-select" id="grupo" [(ngModel)]="newLinea.grupo" name="grupo">
                                <option selected value="Administración">Administración</option>
                                <option value="Analistas de ventas">Analistas de ventas</option>
                                <option value="Compras">Compras</option>
                                <option value="Directores">Directores</option>
                                <option value="Informática">Informática</option>
                              </select>
                            </div>




                          </div>
                        </div>
                      </div>
                      <!-- Info tipo de linea portabilidad -->
                      <div
                        *ngIf="newLinea.tipoLinea === 'Portabilidad' || newLinea.tipoLinea === 'Portabilidad Con Cesión De Contrato'"
                        class="col-12">
                        <div class="p-3 border bg-light">
                          <label for="portabilidad" class="form-label" style="font-weight: bold;">Datos de
                            Portabilidad</label>
                          <div class="row g-3" style="font-size: 12px;">
                            <!-- Tipo de Identificación -->
                            <div *ngIf="newLinea.tipoLinea === 'Portabilidad Con Cesión De Contrato'" class="col-md-3">
                              <label for="tipoIdentificacion" class="form-label">Tipo
                                de
                                Identificación</label>
                              <select class="form-select" id="newLineaTipoIdentificacion"
                                [(ngModel)]="newLinea.portabilidadInfo!.tipoDocumento"
                                name="newLineaTipoIdentificacion">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option value="CC">CC</option>
                                <option value="NIT">NIT</option>
                                <option value="NE">NE</option>
                                <option value="CE">CE</option>
                                <option value="PP">PP</option>
                                <option value="PEP">PEP</option>
                              </select>
                            </div>

                            <!-- Número Documento -->
                            <div *ngIf="newLinea.tipoLinea === 'Portabilidad Con Cesión De Contrato'" class="col-md-3">
                              <label for="numeroDocumento" class="form-label">Número
                                Documento</label>
                              <input type="number" class="form-control" id="newLineanumeroDocumento"
                                [(ngModel)]="newLinea.portabilidadInfo!.numeroDocumento" name="newLineanumeroDocumento">
                            </div>

                            <!-- Fecha de Expedición Documento -->
                            <div
                              *ngIf="newLinea.tipoLinea === 'Portabilidad Con Cesión De Contrato' && newLinea.portabilidadInfo!.tipoDocumento !== 'NIT' && newLinea.portabilidadInfo!.tipoDocumento !== 'NE'"
                              class="col-md-3">
                              <label for="fechaExpedicion" class="form-label">Fecha Expedición documento</label>
                              <input type="date" class="form-control" id="newLineaFechaExpedicion"
                                [(ngModel)]="newLinea.portabilidadInfo!.fechaExpedicion" name="newLineaFechaExpedicion">
                            </div>

                            <!-- Digito de Verificación -->
                            <div
                              *ngIf="newLinea.tipoLinea === 'Portabilidad Con Cesión De Contrato' && newLinea.portabilidadInfo!.tipoDocumento === 'NIT'"
                              class="col-md-3">
                              <label for="anioFechaExpedicion" class="form-label">Digito Verificación</label>
                              <input type="number" class="form-control" id="newLineaAnioFechaExpedicion"
                                [(ngModel)]="newLinea.portabilidadInfo!.digitoVerificacion"
                                name="newLineaAnioFechaExpedicion">
                            </div>

                            <!-- Tipo de Identificación representante legal -->
                            <div
                              *ngIf="newLinea.tipoLinea === 'Portabilidad Con Cesión De Contrato' && (newLinea.portabilidadInfo!.tipoDocumento === 'NIT' || newLinea.portabilidadInfo!.tipoDocumento === 'NE')"
                              class="col-md-3">
                              <label for="tipoIdentificacionRepresentanteLegal" class="form-label">Tipo
                                de
                                Identificación
                                Representante Legal</label>
                              <select class="form-select" id="newLineaRepresentanteLegalTipoIdentificacion"
                                [(ngModel)]="newLinea.portabilidadInfo!.tipoDocumentoRepresentanteLegal"
                                name="newLineaRepresentanteLegalTipoIdentificacion">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option value="CC">CC</option>
                                <option value="NIT">NIT</option>
                                <option value="NE">NE</option>
                                <option value="CE">CE</option>
                                <option value="PP">PP</option>
                                <option value="PEP">PEP</option>
                              </select>
                            </div>

                            <!-- Número Documento representante legal -->
                            <div
                              *ngIf="newLinea.tipoLinea === 'Portabilidad Con Cesión De Contrato' && (newLinea.portabilidadInfo!.tipoDocumento === 'NIT' || newLinea.portabilidadInfo!.tipoDocumento === 'NE')"
                              class="col-md-3">
                              <label for="numeroDocumentoRepresentanteLegal" class="form-label">Número
                                Documento
                                Representante Legal</label>
                              <input type="number" class="form-control" id="newLineanumeroDocumentoRepresentanteLegal"
                                [(ngModel)]="newLinea.portabilidadInfo!.numeroDocumentoRepresentanteLegal"
                                name="newLineanumeroDocumentoRepresentanteLegal">
                            </div>

                            <!-- Fecha de Expedición Documento representante legal -->
                            <div
                              *ngIf="newLinea.tipoLinea === 'Portabilidad Con Cesión De Contrato' && (newLinea.portabilidadInfo!.tipoDocumento === 'NIT' || newLinea.portabilidadInfo!.tipoDocumento === 'NE')"
                              class="col-md-3">
                              <label for="fechaExpedicionRepresentanteLegal" class="form-label">Fecha Expedición
                                documento representante legal</label>
                              <input type="date" class="form-control" id="fechaExpedicionRepresentanteLegal"
                                [(ngModel)]="newLinea.portabilidadInfo!.fechaExpedicionRepresentanteLegal"
                                name="fechaExpedicionRepresentanteLegal">
                            </div>

                            <!-- Telefonia Actual -->
                            <div class="col-md-3">
                              <label for="telefoniaActual" class="form-label">Telefonia Actual</label>
                              <select class="form-select" [(ngModel)]="newLinea.portabilidadInfo!.tipoTelefoniaActual"
                                name="newLineaTelefoniaActual" id="newLineaTelefoniaActual">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option value="Prepago">Prepago</option>
                                <option value="Pospago">Pospago</option>
                              </select>
                            </div>

                            <!-- Tipo solicitante -->
                            <div class="col-md-3">
                              <label for="tipoSolicitante" class="form-label">Tipo solicitante</label>
                              <select class="form-select" [(ngModel)]="newLinea.portabilidadInfo!.tipoSolicitante"
                                name="newLineaTipoSolicitante" id="newLineaTipoSolicitante">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option value="SELF">SELF</option>
                                <option *ngIf="newLinea.portabilidadInfo!.tipoTelefoniaActual === 'Pospago'"
                                  value="THIRDPARTY">THIRDPARTY</option>
                              </select>
                            </div>

                            <!-- Operador donante -->
                            <div class="col-md-3">
                              <label for="operador" class="form-label">Operador donante</label>
                              <select class="form-select" [(ngModel)]="newLinea.portabilidadInfo!.operadorDonante"
                                name="newLineaOperador" id="newLineaOperador">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option value="Claro">Claro</option>
                                <option value="Movistar">Movistar</option>
                                <option value="Wom">Wom</option>
                              </select>
                            </div>

                            <!-- NIP -->
                            <div class="col-md-3">
                              <label for="nipValue" class="form-label">NIP</label>
                              <input type="number" class="form-control" id="nipValue"
                                [(ngModel)]="newLinea.portabilidadInfo!.nip" name="nipValue">
                            </div>

                            <!-- Linea temporal -->
                            <div class="col-md-3">
                              <label for="lineaTemporal" class="form-label">MSISDN temporal</label>
                              <input type="number" class="form-control" id="lineaTemporal"
                                [(ngModel)]="newLinea.portabilidadInfo!.lineaTemporal" name="lineaTemporal">
                            </div>

                            <!-- Tipo venta -->
                            <div class="col-md-3">
                              <label for="tipoVenta" class="form-label">Tipo venta</label>
                              <select class="form-select" [(ngModel)]="newLinea.portabilidadInfo!.tipoVenta"
                                name="newLineaTipoVenta" id="newLineaTipoVenta">
                                <option selected disabled value="">Seleccione...
                                </option>
                                <option value="Sim sola">Sim sola</option>
                                <option value="Sim y telefono">Sim y teléfono</option>
                              </select>
                            </div>

                            <!-- IMEI -->
                            <div *ngIf="newLinea.portabilidadInfo!.tipoVenta === 'Sim y telefono'" class="col-md-3">
                              <label for="imeiPortabilidad" class="form-label">IMEI</label>
                              <input type="text" class="form-control" id="newLineaImeiPortabilidad"
                                [(ngModel)]="newLinea.imei" name="newLineaImeiPortabilidad">
                            </div>

                            <!-- fecha calendarizada?-->
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="esFechaCalendarizada"
                                [(ngModel)]="newLinea.portabilidadInfo!.esFechaCalendarizada"
                                name="esFechaCalendarizada" (change)="changeEsFechaCalendarizada()">
                              <label for="esFechaCalendarizada" class="form-check-label">¿Es fecha
                                calendarizada?</label>
                            </div>

                            <!-- Fecha sugerida de portación -->
                            <div *ngIf="newLinea.portabilidadInfo!.esFechaCalendarizada">
                              <label for="fechaSugeridaPortacion" class="form-label">Fecha sugerida de portación</label>
                              <input type="date" class="form-control" id="fechaSugeridaPortacion"
                                [(ngModel)]="newLinea.portabilidadInfo!.fechaSugeridaPortacion"
                                name="fechaSugeridaPortacion">
                            </div>


                          </div>
                        </div>
                      </div>
                      <!-- Información de cesión de contrato -->
                      <div *ngIf="newLinea.tipoLinea === 'Portabilidad Con Cesión De Contrato'" class="col-12">
                        <div class="p-3 border bg-light">
                          <label for="portabilidad" class="form-label" style="font-weight: bold;">Datos de cesión de
                            contrato</label>
                          <div class="row g-3" style="font-size: 12px;">
                            <div class="col-md-12">
                              <div class="alert alert-success">
                                <div class="row">
                                  <div class="col-8"><b>Los datos de la cesión de contrato se obtienen del cliente
                                      asociado al contrato</b>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col-8"><b>Nombre cliente:</b>
                                  </div>
                                  <div class="col-4">{{this.legalNameParam}}</div>
                                </div>
                                <div class="row">
                                  <div class="col-8"><b>Número documento cliente:</b></div>
                                  <div class="col-4">{{this.documentNumberParam}}</div>
                                </div>
                                <div class="row">
                                  <div class="col-8"><b>Tipo documento cliente:</b></div>
                                  <div class="col-4">{{this.documentTypeParam}}</div>
                                </div>
                              </div>
                            </div>

                          </div>
                        </div>
                      </div>

                      <div class="col-12">
                        <div class="p-3 border bg-light">
                          <div class="row g-3">



                            <div class="col-md-4">
                              <div class="input-group">
                                <select class="form-select" [(ngModel)]="addService.tipo" name="addServiceTipo"
                                  id="addServiceTipo">
                                  <option selected disabled value="">
                                    Seleccione...
                                  </option>
                                  <option value="roaming1">
                                    Roaming 1</option>
                                  <option value="roaming2">
                                    Roaming 2</option>
                                  <option value="ldi">LDI
                                  </option>
                                  <option value="numeroPrivado">
                                    Número Privado</option>
                                </select>
                              </div>
                            </div>

                            <div class="col-md-4">

                              <div class="input-group">
                                <input type="number" class="form-control" id="porcentajeDescuentoAddService"
                                  name="porcentajeDescuentoAddService" [(ngModel)]="addService.descuento">
                                <span class="input-group-text">%</span>
                              </div>
                            </div>

                            <div class="col-md-4">
                              <button class="btn btn-primary" type="button" id="adicionarServicioAdicionalButton"
                                (click)="adicionarServicioAdicional()">Adicionar
                                Servicio</button>

                            </div>



                            <div class="col-12">
                              <div class="table-responsive">
                                <table class="table table-striped table-hover" id="tablaServiciosAdicionales">
                                  <thead>
                                    <tr>
                                      <th>Servicio Adicional</th>
                                      <th>Cargo Básico</th>
                                      <th>% Descuento</th>
                                      <th></th>

                                    </tr>
                                  </thead>
                                  <tbody>
                                    <tr *ngFor="let servicio of newLinea.addServices; let i = index">
                                      <td>{{ servicio.tipo }}</td>
                                      <td>{{ servicio.cargoBasico }}</td>
                                      <td>{{ servicio.descuento }}</td>
                                      <td>
                                        <button class="btn btn-danger btn-sm" type="button"
                                          id="eliminarServicioAdicionalButton"
                                          (click)="eliminarServicioAdicional(i)">Eliminar</button>
                                      </td>
                                      <td>

                                      </td>
                                    </tr>
                                  </tbody>
                                </table>
                              </div>
                            </div>



                          </div>
                        </div>
                      </div>

                      <div class="col-12">
                        <div class="p-3 border bg-light">
                          <div class="row g-3">

                            <div class="col-md-9">

                            </div>



                            <div class="col-md-3 text-end">
                              <button class="btn btn-primary" type="submit" id="adicionarLineaButton">Adicionar
                                Línea</button>
                            </div>


                          </div>
                        </div>
                      </div>

                    </form>

                  </div>

                  <div class="card-footer text-end">

                    <div class="row">
                      <div class="col-9">


                      </div>

                      <div class="col-3">
                        <button type="button" class="btn btn-success" (click)="createModal(4)">SIGUIENTE</button>
                      </div>

                    </div>


                  </div>

                </div>


              </div>
              <div class="tab-pane fade" id="registro-equipos" role="tabpanel" aria-labelledby="registro-equipos-tab">
                <div class="card mt-2">
                  <div class="card-header">
                    Registro de Equipos
                  </div>
                  <div class="card-body">

                    <div *ngIf="newContract.contract.tipoContrato==='Estandar'" class="alert alert-info">
                      La redención de equipos pertenece a los contratos Negociados.
                    </div>

                    <div *ngIf="newContract.contract.tipoContrato==='Negociado'">

                      <form class="row g-2" id="myDeviceForm" (ngSubmit)="adicionarEquipo()" #myDeviceForm="ngForm">


                        <div class="col-12">
                          <div class="p-3 border bg-light">

                            <div class="row g-3">

                              <div class="col-md-3">
                                <label for="equipo" class="form-label">Equipo</label>
                                <select class="form-select" id="equipo" name="equipo" [(ngModel)]="deviceSelected"
                                  (change)="onSeleccionarEquipo($event)">
                                  <option selected disabled value="">Seleccione...
                                  </option>

                                  <option *ngFor="let inventario of inventarios" [value]="inventario.name">{{
                                    inventario.name }}
                                  </option>


                                </select>
                              </div>
                              <div class="col-md-3">
                                <label for="cantidadInventario" class="form-label">Cantidad
                                  en
                                  Inventario</label>
                                <input type="text" class="form-control" id="cantidadInventario"
                                  name="cantidadInventario" [value]="inventarioSeleccionado?.cantidad || ''" readonly>
                              </div>

                              <div class="col-md-3">
                                <label for="valorEquipo" class="form-label">Valor
                                  (sin
                                  IVA)</label>
                                <div class="input-group">
                                  <span class="input-group-text">$</span>
                                  <input type="text" class="form-control" id="valorEquipo" name="valorEquipo"
                                    [value]="inventarioSeleccionado?.precioUnitario || ''" readonly>
                                </div>
                              </div>
                              <div class="col-md-3">
                                <label for="redencionEquipos" class="form-label">Redención
                                  de
                                  Equipos</label>
                                <select class="form-select" id="redencionEquipos" name="redencionEquipos"
                                  [(ngModel)]="nuevoEquipo.redencionEquipos" (change)="updateRedencionNO()">
                                  <option selected disabled value="">Seleccione...
                                  </option>
                                  <option value="SI">SI</option>
                                  <option value="NO">NO</option>
                                </select>
                              </div>
                              <div class="col-md-3">
                                <label for="cantidad" class="form-label">Cantidad</label>
                                <input type="number" class="form-control" id="cantidad" name="cantidad"
                                  [(ngModel)]="nuevoEquipo.cantidad">
                              </div>
                              <div class="col-md-3">
                                <label for="porcentajeDescuento" class="form-label">% a redimir por equipo</label>
                                <div class="input-group">
                                  <input type="number" class="form-control" id="porcentajeDescuento"
                                    name="porcentajeDescuento" [(ngModel)]="nuevoEquipo.porcentajeDescuento">
                                  <span class="input-group-text">%</span>
                                </div>
                              </div>
                              <div class="col-md-3">
                                <label for="valorDescontado" class="form-label">Valor
                                  Descontado</label>
                                <div class="input-group">
                                  <span class="input-group-text">$</span>
                                  <input type="text" class="form-control" id="valorDescontado" name="valorDescontado"
                                    [value]="(nuevoEquipo.cantidad * (inventarioSeleccionado?.precioUnitario || 0) * ( (nuevoEquipo.porcentajeDescuento / 100))).toFixed(2)"
                                    readonly>
                                </div>
                              </div>
                              <div class="col-md-3">
                                <label for="valorEquipoTotal" class="form-label">Valor
                                  Total</label>
                                <div class="input-group">
                                  <span class="input-group-text">$</span>
                                  <input type="text" class="form-control" id="valorEquipoTotal" name="valorEquipoTotal"
                                    [value]="(nuevoEquipo.cantidad * (inventarioSeleccionado?.precioUnitario || 0) * ( 1 - (nuevoEquipo.porcentajeDescuento / 100))).toFixed(2)"
                                    readonly>

                                </div>

                              </div>

                              <div class="col-md-9">

                              </div>

                              <div class="col-md-3 text-end">
                                <button type="submit" class="btn btn-primary" id="adicionarEquipoButton">Adicionar
                                  Equipo</button>

                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-12">
                          <div class="p-3 border bg-light">
                            <div class="row g-3">

                              <div class="col-3">

                              </div>






                            </div>
                          </div>
                        </div>

                        <div class="col-12">
                          <div class="p-3 border bg-light">
                            <div class="row g-3">
                              <div class="col-md-3">
                                Valor Pendiente por redimir

                              </div>

                              <div class="col-md-3">
                                $ {{
                                newContract.contract.saldoBolsa.toFixed(2) }}
                              </div>

                              <div class="col-md-3">
                                Valor pendiente por redimir
                              </div>

                              <div class="col-md-3">
                                $ {{
                                newContract.contract.valorNoRedimible.toFixed(2) }}
                              </div>

                              <div class="col-md-12">

                                <div class="table-responsive">
                                  <table class="table table-striped table-hover">
                                    <thead>
                                      <tr>
                                        <th>Equipo</th>
                                        <th>Cantidad</th>
                                        <th>Valor del Equipo</th>
                                        <th>% Descuento</th>
                                        <th>Valor Descontado</th>
                                        <th>Valor Total</th>
                                        <th>Redención de Equipos</th>
                                        <th>Acciones</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <tr *ngFor="let equipo of newContract.devices; let i = index">
                                        <td>{{ equipo.equipo }}</td>
                                        <td>{{ equipo.cantidad }}</td>
                                        <td>{{ equipo.valorEquipo | currency }}
                                        </td>
                                        <td>{{ equipo.porcentajeDescuento }}%
                                        </td>
                                        <td>{{ (equipo.cantidad *
                                          equipo.valorEquipo *
                                          ((equipo.porcentajeDescuento /
                                          100))) | currency }}</td>
                                        <td>{{ (equipo.cantidad *
                                          equipo.valorEquipo * (1 -
                                          (equipo.porcentajeDescuento / 100)))
                                          | currency }}</td>
                                        <td>{{ equipo.redencionEquipos }}</td>
                                        <td>
                                          <button class="btn btn-danger btn-sm" type="button" id="eliminarEquipoButton"
                                            (click)="eliminarEquipo(i)">Eliminar</button>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </div>
                              </div>

                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                  <div class="card-footer text-end">

                    <div class="row">
                      <div class="col-9">


                      </div>

                      <div class="col-3">
                        <button type="button" class="btn btn-success" (click)="createModal(5)">SIGUIENTE</button>
                      </div>

                    </div>


                  </div>
                </div>
              </div>
              <div class="tab-pane fade" id="resumen-venta" role="tabpanel" aria-labelledby="resumen-venta-tab">
                <div class="card mt-2">
                  <div class="card-header">
                    Resumen antes de activación
                  </div>
                  <div class="card-body">
                    <div class="row g-1">
                      <div class="col-12">
                        <div class="p-3 border bg-light">
                          <div class="row g-1">

                            <div class="col-md-4">
                              <p id="numeroContratoResume">Número Contrato: {{
                                newContract.contract.numeroContrato }}</p>
                            </div>

                            <div class="col-md-4">
                              <p id="tipoContrato">Tipo Contrato: {{
                                newContract.contract.tipoContrato }}</p>
                            </div>

                            <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Estandar'">
                              <p id="inicioVigencia">Inicio de Vigencia: {{
                                newServiceOrder.startDate| date:
                                'dd/MM/yyyy' }}
                              </p>
                            </div>

                            <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Estandar'">

                              <p id="mesesContrato">Meses de Contrato:{{
                                newServiceOrder.durationMonths }}</p>
                            </div>

                            <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Estandar'">

                              <p id="finVigencia">Fin de Vigencia: {{
                                newServiceOrder.finVigencia | date:
                                'dd/MM/yyyy'}}</p>
                            </div>


                          </div>
                        </div>
                      </div>

                      <div class="card-header">
                        Cuentas de facturación
                      </div>

                      <div class="col-12">
                        <div class="p-3 border bg-light">

                          <div class="row g-1" *ngIf="newContract.billAccounts.length>0">
                            <div class="table-responsive">
                              <table class="table table-striped table-hover">
                                <thead>
                                  <tr>
                                    <th scope="col">Id cuenta</th>
                                    <th scope="col"># Cuenta Facturación
                                    </th>
                                    <th scope="col">Ciclo de Facturación
                                    </th>
                                    <th scope="col">Fecha de creación</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr *ngFor="let cuenta of newContract.billAccounts; let i = index">

                                    <td>{{ cuenta.cuentaFacturacion ?
                                      cuenta.cuentaFacturacion : "NUEVA " +
                                      cuenta.id }}</td>
                                    <td>{{ cuenta.cuentaFacturacion ?
                                      cuenta.cuentaFacturacion :
                                      "PENDIENTE" }}</td>
                                    <td>{{ cuenta.cicloFacturacion ?
                                      cuenta.cicloFacturacion :
                                      "PENDIENTE" }}</td>
                                    <td>{{ cuenta.fechaCreacion ?
                                      ( cuenta.fechaCreacion | date:
                                      'dd/MM/yyyy' ) :
                                      "PENDIENTE" }}</td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                          </div>

                        </div>
                      </div>

                      <div class="card-header" *ngIf="newContract.contract.tipoContrato==='Negociado'">
                        Orden de Servicio
                      </div>

                      <div class="col-12" *ngIf="newContract.contract.tipoContrato==='Negociado'">
                        <div class="p-3 border bg-light">
                          <div class="row g-1">

                            <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Negociado'">
                              <p id="ordenServicioResumen">Orden de Servicio: {{
                                newServiceOrder.serviceOrder }}</p>
                            </div>

                            <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Negociado'">
                              <p id="inicioVigencia">Inicio de Vigencia: {{
                                newServiceOrder.startDate |  date:
                                'dd/MM/yyyy' }}
                              </p>
                            </div>

                            <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Negociado'">

                              <p id="mesesContrato">Meses de Contrato:{{
                                newServiceOrder.durationMonths }}</p>
                            </div>

                            <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Negociado'">

                              <p id="finVigencia">Fin de Vigencia: {{
                                newServiceOrder.finVigencia }}</p>
                            </div>

                            <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Negociado'">

                              <p id="codigoVendedor">Valor bolsa: {{
                                newServiceOrder.bagValue
                                }}</p>
                            </div>

                            <div class="col-md-4" *ngIf="newContract.contract.tipoContrato==='Negociado'">
                              <p id="codigoVendedor">Código vendedor: {{
                                newServiceOrder.sellerId
                                }}</p>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="col-12">
                        <div class="p-1 border bg-light">

                          <div class="alert alert-info">
                            El detalle de planes y lineas no contiene los descuentos
                            por
                            promociones y/o masivos aplicados.
                          </div>

                        </div>
                      </div>

                      <div class="col-md-4" *ngIf="this.variables.esCargueMasivo">
                        <button class="btn btn-primary" type="button" id="adicionarServicioAdicionalButton"
                         >Descargar resumen
                          </button>

                      </div>

                      <div class="col-12" *ngIf="this.newContract.plans.length>0">
                        <div class="p-3 border bg-light">
                          <div class="row g-1">

                            <ul class="nav nav-tabs" id="myResumeTab" role="tablist">
                              <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="tab1-tab" data-bs-toggle="tab"
                                  data-bs-target="#planes_tab" type="button" role="tab" aria-controls="tab1"
                                  aria-selected="true">Productos</button>
                              </li>
                              <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab2-tab" data-bs-toggle="tab" data-bs-target="#lineas_tab"
                                  type="button" role="tab" aria-controls="tab2" aria-selected="false">Lineas</button>
                              </li>

                              <li class="nav-item" role="presentation">
                                <button class="nav-link" id="tab3-tab" data-bs-toggle="tab"
                                  data-bs-target="#devices_tab" type="button" role="tab" aria-controls="tab3"
                                  aria-selected="false">Equipos</button>
                              </li>
                            </ul>
                            <div class="tab-content" id="myTabContent">
                              <div class="tab-pane fade show active" id="planes_tab" role="tabpanel"
                                aria-labelledby="tab1-tab">

                                <div class="row mt-3" *ngIf="newContract.plans.length > 0">

                                  <div class="table-responsive">
                                    <table class="table table-striped table-hover">
                                      <thead>
                                        <tr>

                                          <th>Cuenta Facturación</th>
                                          <th>Plan</th>
                                          <th>Cantidad de líneas</th>
                                          <th>Precio Total sin impuestos</th>
                                          <th>Tipo de Envío</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr *ngFor="let finalPlan of newContract.plans; let i = index">

                                          <td>{{
                                            finalPlan.cuentaFacturacion
                                            ?
                                            finalPlan.cuentaFacturacion
                                            : "NUEVA " +
                                            finalPlan.idCuentaFacturacion
                                            }}
                                          </td>
                                          <td>{{ finalPlan.plan }}
                                          </td>
                                          <td>{{ finalPlan.cantidad }}
                                          </td>
                                          <td>{{
                                            finalPlan.valorUnitario
                                            * (1
                                            -
                                            (finalPlan.valorDescuento
                                            /
                                            100)) *
                                            finalPlan.cantidad
                                            }}</td>
                                          <td>{{ finalPlan.tipoEnvio
                                            }}</td>
                                        </tr>

                                      </tbody>
                                    </table>
                                  </div>
                                </div>

                              </div>
                              <div class="tab-pane fade" id="lineas_tab" role="tabpanel" aria-labelledby="tab2-tab">
                                <div class="row mt-3" *ngIf="newContract.lineas.length > 0">
                                  <div class="table-responsive">
                                    <table class="table table-striped">
                                      <thead>
                                        <tr>

                                          <th>MSISDN</th>
                                          <th>Tipo Línea</th>
                                          <th>IMSI</th>
                                          <th>IMEI</th>
                                          <th>Grupo</th>
                                          <th>Precio Total sin impuesto</th>
                                          <th>Detalles</th>
                                          <th>Acciones</th>
                                        </tr>
                                      </thead>
                                      <tbody>
                                        <tr *ngFor="let linea of newContract.lineas; let i = index">

                                          <td>{{ linea.numeroLinea }}</td>
                                          <td>{{ linea.tipoLinea }}</td>
                                          <td>{{ linea.imsi }}</td>
                                          <td>{{ linea.imei }}</td>
                                          <td>{{ linea.grupo }}</td>
                                          <td>{{ linea.valorUnitario ?
                                            (linea.valorDescuento ?
                                            (linea.valorUnitario * (1 -
                                            (linea.valorDescuento / 100
                                            ))) : linea.valorUnitario) :
                                            0 }}</td>
                                            <td>
                                                <button class="btn btn-primary btn-sm" (click)="selectLineaByImsi(linea.imsi); openModal()">
                                                  Ver detalles
                                                </button>

                                            </td>
                                          <td>
                                            <button class="btn btn-danger btn-sm"
                                              (click)="eliminarLinea(i)">Eliminar</button>
                                          </td>
                                        </tr>
                                      </tbody>
                                    </table>
                                  </div>
                                </div>
                              </div>

                              <div class="tab-pane fade" id="devices_tab" role="tabpanel" aria-labelledby="tab3-tab">

                                <div class="container" *ngIf="newContract.devices.length > 0">



                                  <div class="row">
                                    <div class="table-responsive">
                                      <table class="table table-striped table-hover">
                                        <thead>
                                          <tr>
                                            <th>Orden de servicio</th>

                                            <th>Fecha</th>
                                            <th>Id Cliente SAP</th>
                                            <th>Cliente SAP</th>
                                            <th>Tipo de Venta SAP</th>
                                            <th>Id. Orden SAP</th>

                                            <th>Valor Redención</th>
                                            <th>Descuento</th>
                                            <th>Total</th>

                                            <th>Ver detalles</th>

                                          </tr>
                                        </thead>
                                        <tbody>
                                          <tr *ngFor="let equipo of newContract.devices; let i = index">
                                            <td>{{ newServiceOrder.serviceOrder }}
                                            </td>

                                            <th>{{ "18/10/2024" }}</th>
                                            <th>{{ 900559843 }}</th>
                                            <th>{{ "COLOMBIA MÓVIL" }}</th>
                                            <th>{{  "52 - Linea Nueva"}}</th>
                                            <th>{{ 528138 }}</th>

                                            <td>{{
                                              (equipo.cantidad *
                                              equipo.valorEquipo * (1 -
                                              (equipo.porcentajeDescuento
                                              / 100))) | currency

                                              }}</td>

                                              <td>{{
                                                (equipo.cantidad *
                                                equipo.valorEquipo * (1 -
                                                (equipo.porcentajeDescuento
                                                / 100))) | currency

                                                }}</td>

                                              <td>{{0 | currency}}</td>
                                              <td>
                                                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#verDetalleEquiposModal">
                                                  Ver Detalles
                                                </button>
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </div>

                                  </div>

                                  <div class="col-md-12">
                                    <div class="alert alert-info">
                                      <div class="row">
                                        <div class="col-8"><b>Valor Bolsa: </b>
                                        </div>
                                        <div class="col-4">{{
                                          newContract.contract.saldoBolsa|
                                          currency }} </div>
                                      </div>
                                      <div class="row">
                                        <div class="col-8"><b>Saldo:</b>
                                        </div>
                                        <div class="col-4">{{
                                          0 < 0 ? 0 : 0 | currency }} </div>
                                        </div>
                                        <div class="row">
                                          <div class="col-8"><b>Valor pendiente por redimir:
                                            </b></div>
                                          <div class="col-4">{{
                                            newContract.contract.saldoBolsa > 0 ?
                                            newContract.contract.valorNoRedimible.toFixed(2)
                                            :
                                            (newContract.contract.valorNoRedimible
                                            + (-1 *
                                            newContract.contract.saldoBolsa)).toFixed(2)
                                            | currency }}</div>
                                        </div>
                                      </div>
                                    </div>





                                  </div>



                                </div>
                              </div>

                            </div>
                          </div>
                        </div>

                        <div class="row g-2">


                        </div>
                      </div>
                    </div>
                    <div class="card-footer text-end">
                      <div class="row">
                        <div class="col-9">
                          <div *ngIf="false" class="alert alert-warning">
                            myCreateContractForm.errors

                          </div>


                        </div>

                        <div class="col-3">
                          <button type="button" class="btn btn-primary" (click)="createModal(6)">ACTIVAR</button>
                        </div>

                      </div>


                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>





  </div>

  <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#verDetalleModal">
  Ver Detalles
</button>

<!-- Modal -->
<div class="modal fade" id="verDetalleEquiposModal" tabindex="-1" aria-labelledby="verDetalleEquiposModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="verDetalleEquiposModalLabel">Ver Detalle Equipos Seleccionados</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <table class="table table-striped table-hover">
          <thead>
          <tr>
            <th scope="col">Equipo</th>
            <th scope="col">Cantidad</th>
            <th scope="col">Valor Unitario</th>
            <th scope="col">Porcentaje Redención</th>
            <th scope="col">Total Redención</th>
            <th scope="col">Total</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let cuenta of newContract.devices; let i = index">
            <td>{{ cuenta.equipo }}</td>
            <td>{{ cuenta.cantidad }}</td>
            <td>{{ cuenta.valorEquipo }}</td>
            <td>{{ cuenta.porcentajeDescuento }}</td>
            <td>{{ (cuenta.valorEquipo * cuenta.cantidad)*(cuenta.porcentajeDescuento/100)  | currency: 'USD':'symbol':'1.2-2'}}</td>
            <td>{{ (cuenta.valorEquipo * cuenta.cantidad)*(1 - cuenta.porcentajeDescuento/100)   | currency: 'USD':'symbol':'1.2-2'}}</td>
          </tr>
          </tbody>
          </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="verDetalleLineaNegociadoModal" tabindex="-1" aria-labelledby="verDetalleLineaNegociadoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="verDetalleLineaNegociadoModal">Ver Detalle Línea</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <h5>Detalle Línea</h5>
        <table class="table table-striped table-hover">
          <thead>
          <tr>
            <th scope="col">Servicio</th>
            <th scope="col">Precio sin Imp</th>
            <th scope="col">% Descuento</th>
            <th scope="col">Valor Descuento</th>
            <th scope="col">Motivo Descuento</th>
            <th scope="col">Precio total sin Imp</th>

          </tr>
          </thead>
          <tbody>
          <tr *ngIf="selectedLinea">
            <td>{{ selectedLinea.plan }}</td>
            <td>{{ selectedLinea.valorUnitario }}</td>
            <td>{{ selectedLinea.valorDescuento || 0 }}</td>
            <td>{{ selectedLinea.valorDescuento }}</td>
            <td>{{ selectedLinea.motivoDescuento }}</td>
            <td>{{ selectedLinea.valorTotal }}</td>
          </tr>

          <ng-container *ngIf="selectedLinea?.addServices?.length">
            <tr *ngFor="let service of selectedLinea?.addServices">
              <td>{{ service.tipo }}</td>
              <td>{{ service.cargoBasico }}</td>
              <td>{{ service.descuento || 0 }}</td>
              <td>{{ (service.cargoBasico * (service.descuento / 100)) | number: '1.2-2' }}</td>
              <td>{{ 'Descuento por servicio' }}</td>
              <td>{{ (service.cargoBasico - (service.cargoBasico * (service.descuento / 100))) | number: '1.2-2' }}</td>
            </tr>
          </ng-container>


          </tbody>
          </table>

          <h5>Descuentos Adicionales</h5>
          <table class="table table-striped table-hover">
              <thead>
                  <tr>
                      <th scope="col">Tipo de Descuento</th>
                      <th scope="col">Porcentaje</th>
                      <th scope="col">Descripción</th>
                      <th scope="col">Mes</th>
                  </tr>
              </thead>
              <tbody>
                <tr *ngFor="let service of selectedLinea?.addServices">

                  <tr *ngFor="let descuento of newContract.discount.mesesAnio">
                      <td>{{ "Descuento Discontinuo" }}</td>
                      <td>{{ 3 }}%</td>
                      <td>{{ " " }}</td>
                      <td>{{ "mes" }}</td>
                  </tr>
              </tbody>
          </table>


          <h5>Detalle Portabilidad</h5>
          <table class="table table-striped table-hover">
              <thead>
                  <tr>
                      <th scope="col">NIP</th>
                      <th scope="col">Operador Donante</th>
                      <th scope="col">Tipo Identificación</th>
                      <th scope="col">Número Documento</th>
                      <th scope="col">Número Temporal</th>
                  </tr>
              </thead>
              <tbody>
                  <tr *ngFor="let descuento of descuentosAdicionales">
                      <td>{{ "" }}</td>
                      <td>{{ "" }}%</td>
                      <td>{{ "" }}</td>
                      <td>{{ "" }}</td>
                      <td>{{ "" }}</td>
                  </tr>
              </tbody>
          </table>


      </div>



      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
