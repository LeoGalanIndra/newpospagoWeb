<div class="card">
    <form id="myCreateContractForm">

        <div class="card-header text-center">
            Configuración Venta - Nuevo Pospago B2B
        </div>
        <div class="card-body">
            <div>

                <div class="card">

                    <div class="card-body">
                        <h5 class="card-title  text-center">Cliente: {{ this.documentNumberParam }} - {{
                            this.legalNameParam }}</h5>

                        <div class="container">
                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="info-contrato-tab" data-bs-toggle="tab"
                                        data-bs-target="#info-contrato" type="button" role="tab"
                                        aria-controls="info-contrato" aria-selected="true">Contrato</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="cuenta-facturacion-tab" data-bs-toggle="tab"
                                        data-bs-target="#cuenta-facturacion" type="button" role="tab"
                                        aria-controls="cuenta-facturacion" aria-selected="false">Cuenta
                                        Facturación</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="descuento-tab" data-bs-toggle="tab"
                                        data-bs-target="#descuento" type="button" role="tab" aria-controls="descuento"
                                        aria-selected="false">Descuentos</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="producto-tab" data-bs-toggle="tab"
                                        data-bs-target="#producto" type="button" role="tab" aria-controls="producto"
                                        aria-selected="false">Producto</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="registro-equipos-tab" data-bs-toggle="tab"
                                        data-bs-target="#registro-equipos" type="button" role="tab"
                                        aria-controls="registro-equipos" aria-selected="false">Equipos</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="resumen-venta-tab" data-bs-toggle="tab"
                                        data-bs-target="#resumen-venta" type="button" role="tab"
                                        aria-controls="resumen-venta" aria-selected="false">Resumen</button>
                                </li>
                            </ul>
                            <div class="tab-content" id="myTabContent">
                                <div class="tab-pane fade show active" id="info-contrato" role="tabpanel"
                                    aria-labelledby="info-contrato-tab">
                                    <div class="card mt-1">
                                        <div class="card-header">
                                            Información de contrato
                                        </div>
                                        <div class="card-body">

                                            <div class="row g-1">
                                                <div class="col-md-12">
                                                    <div class="p-2 border bg-light">
                                                        <div class="row g-1">

                                                            <div class="col-md-4">
                                                                <label for="numeroContrato" class="form-label">Número
                                                                    Contrato</label>
                                                                <input type="text" class="form-control"
                                                                    id="numeroContrato" required
                                                                    [(ngModel)]="newContract.contract.numeroContrato"
                                                                    name="numeroContrato">
                                                            </div>
                                                            <div class="col-md-4">
                                                                <label for="tipoContrato" class="form-label">Tipo
                                                                    Contrato</label>
                                                                <select class="form-select" id="tipoContrato" required
                                                                    [(ngModel)]="newContract.contract.tipoContrato"
                                                                    name="tipoContrato">
                                                                    <option selected disabled value="">Seleccione...
                                                                    </option>
                                                                    <option value="Estandar">Contrato Estandar</option>
                                                                    <option value="Negociado">Contrato Negociado
                                                                    </option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-4">
                                                                <label for="inicioVigencia" class="form-label">Inicio de
                                                                    Vigencia</label>
                                                                <input type="date" class="form-control"
                                                                    id="inicioVigencia" required
                                                                    [(ngModel)]="newContract.contract.inicioVigencia"
                                                                    name="inicioVigencia"
                                                                    (ngModelChange)="calcularMesFinContrato()">
                                                            </div>
                                                            <div class="col-md-4">
                                                                <label for="mesesContrato" class="form-label">Meses de
                                                                    Contrato</label>
                                                                <input type="number" class="form-control"
                                                                    id="mesesContrato" required
                                                                    [(ngModel)]="newContract.contract.mesesContrato"
                                                                    (ngModelChange)="calcularMesFinContrato()"
                                                                    name="mesesContrato">
                                                            </div>
                                                            <div class="col-md-4">
                                                                <label for="finVigencia" class="form-label">Fin de
                                                                    Vigencia</label>
                                                                <input type="text" class="form-control" id="finVigencia"
                                                                    readonly
                                                                    [(ngModel)]="newContract.contract.finVigencia"
                                                                    name="finVigencia">
                                                            </div>
                                                            <div class="col-md-4">
                                                                <label for="codigoVendedor"
                                                                    class="form-label">Identificación
                                                                    del KAM</label>
                                                                <input type="number" class="form-control"
                                                                    id="codigoVendedor" required
                                                                    [(ngModel)]="newContract.contract.codigoVendedor"
                                                                    name="codigoVendedor">
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                                <div *ngIf="newContract.contract.tipoContrato==='Estandar'"
                                                    class="alert alert-info">
                                                    La configuración de bolsas de equipos pertenece a los contratos
                                                    Negociados.
                                                </div>
                                                <div class="col-md-12"
                                                    *ngIf="newContract.contract.tipoContrato==='Negociado'">

                                                    <div class="p-2 border bg-light">
                                                        <div class="row g-1">
                                                            <div class="col-md-6">
                                                                <label for="valorBolsa" class="form-label">Valor
                                                                    Bolsa</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" class="form-control"
                                                                        id="valorBolsa" required
                                                                        [(ngModel)]="newContract.contract.valorBolsa"
                                                                        name="valorBolsa">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <label for="saldo" class="form-label">Saldo</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" class="form-control" id="saldo"
                                                                        required
                                                                        [(ngModel)]="newContract.contract.saldo"
                                                                        name="saldo">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-md-12">

                                                </div>
                                            </div>

                                            <div class="row g-3">


                                            </div>

                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="cuenta-facturacion" role="tabpanel"
                                    aria-labelledby="cuenta-facturacion-tab">
                                    <div class="card mt-2">
                                        <div class="card-header">
                                            Cuenta de Facturación
                                        </div>
                                        <div class="card-body">


                                            <div class="row g-2" *ngIf="newContract.billAccounts.length>0">
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-hover">
                                                        <thead>
                                                            <tr>
                                                                <th scope="col">Seleccione cuenta</th>
                                                                <th scope="col">Id cuenta</th>
                                                                <th scope="col"># Cuenta Facturación</th>
                                                                <th scope="col">Ciclo de Facturación</th>
                                                                <th scope="col">Fecha de creación</th>
                                                                <th scope="col"></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr
                                                                *ngFor="let cuenta of newContract.billAccounts; let i = index">
                                                                <td>
                                                                    <input type="radio" name="selectedAccount"
                                                                        [value]="cuenta.id"
                                                                        [(ngModel)]="selectedAccountId"
                                                                        (change)="selectAccount(cuenta.id)">
                                                                </td>
                                                                <td>{{ cuenta.id }}</td>
                                                                <td>{{ cuenta.cuentaFacturacion ?
                                                                    cuenta.cuentaFacturacion : "PENDIENTE" }}</td>
                                                                <td>{{ cuenta.cicloFacturacion ?
                                                                    cuenta.cicloFacturacion : "PENDIENTE" }}</td>
                                                                <td>{{ cuenta.fechaCreacion ? cuenta.fechaCreacion :
                                                                    "PENDIENTE" }}</td>
                                                                <td><button type="button" class="btn btn-danger btn-sm"
                                                                        (click)="eliminarCuenta(i)">Eliminar</button>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-footer text-end">
                                            <button type="button" class="btn btn-primary" id="adicionarCuentaButton"
                                                (click)="adicionarCuenta()">Adicionar Cuenta Facturación</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="descuento" role="tabpanel"
                                    aria-labelledby="descuento-tab">
                                    <div class="card mt-2">
                                        <div class="card-header">
                                            Descuento Personalizado Discontinuo
                                        </div>
                                        <div class="card-body">

                                            <div *ngIf="newContract.contract.tipoContrato==='Estandar'"
                                                class="alert alert-info">
                                                La configuración de descuentos personalizados solo corresponde a los
                                                contratos Negociados
                                            </div>

                                            <!-- src/app/components/nuevo-formulario/nuevo-formulario.component.html -->

                                            <!-- Campos existentes -->

                                            <!-- Nueva sección de Descuentos -->
                                            <div class="row g-3 mt-4"
                                                *ngIf="newContract.contract.tipoContrato==='Negociado'">
                                                <div class="col-md-3">
                                                    <label for="valorDescuento" class="form-label">Valor del
                                                        Descuento</label>
                                                    <div class="input-group">
                                                        <input type="number" class="form-control" id="valorDescuento"
                                                            step="0.01" required
                                                            [(ngModel)]="newContract.discount.valorDescuento"
                                                            name="valorDescuento">
                                                        <span class="input-group-text">%</span>
                                                    </div>
                                                </div>

                                                <div class="col-md-3">
                                                    <label for="motivoDescuento" class="form-label">Motivo del
                                                        Descuento</label>
                                                    <select class="form-select" id="motivoDescuento" required
                                                        [(ngModel)]="newContract.discount.motivoDescuento"
                                                        name="motivoDescuento">
                                                        <option selected disabled value="">Seleccione...
                                                        </option>
                                                        <option value="motivo1">Descuento Comercial</option>
                                                        <option value="motivo2">Descuento por Retención</option>
                                                        <option value="motivo3">Descuento por renovación
                                                            comercial</option>
                                                    </select>
                                                </div>

                                                <div class="col-md-6">
                                                    <ul class="list-group list-group-horizontal">
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox1" (change)="toggleMonth('ENE')"
                                                                [checked]="newContract.discount.meses.includes('ENE')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox1">ENE</label>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox2" (change)="toggleMonth('FEB')"
                                                                [checked]="newContract.discount.meses.includes('FEB')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox2">FEB</label>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox3" (change)="toggleMonth('MAR')"
                                                                [checked]="newContract.discount.meses.includes('MAR')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox3">MAR</label>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox4" (change)="toggleMonth('ABR')"
                                                                [checked]="newContract.discount.meses.includes('ABR')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox4">ABR</label>
                                                        </li>
                                                    </ul>

                                                    <ul class="list-group list-group-horizontal">
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox5" (change)="toggleMonth('MAY')"
                                                                [checked]="newContract.discount.meses.includes('MAY')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox5">MAY</label>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox6" (change)="toggleMonth('JUN')"
                                                                [checked]="newContract.discount.meses.includes('JUN')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox6">JUN</label>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox7" (change)="toggleMonth('JUL')"
                                                                [checked]="newContract.discount.meses.includes('JUL')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox7">JUL</label>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox8" (change)="toggleMonth('AGO')"
                                                                [checked]="newContract.discount.meses.includes('AGO')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox8">AGO</label>
                                                        </li>
                                                    </ul>

                                                    <ul class="list-group list-group-horizontal">
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox9" (change)="toggleMonth('SEP')"
                                                                [checked]="newContract.discount.meses.includes('SEP')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox9">SEP</label>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox10" (change)="toggleMonth('OCT')"
                                                                [checked]="newContract.discount.meses.includes('OCT')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox10">OCT</label>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox11" (change)="toggleMonth('NOV')"
                                                                [checked]="newContract.discount.meses.includes('NOV')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox11">NOV</label>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <input class="form-check-input" type="checkbox"
                                                                id="inlineCheckbox12" (change)="toggleMonth('DIC')"
                                                                [checked]="newContract.discount.meses.includes('DIC')">
                                                            <label class="form-check-label"
                                                                for="inlineCheckbox12">DIC</label>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>



                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="producto" role="tabpanel" aria-labelledby="producto-tab">
                                    <div class="card mt-2">
                                        <div class="card-header">
                                            Producto a activar
                                        </div>
                                        <div class="card-body">
                                            <h5 class="card-title"></h5>

                                            <div class="row g-2">
                                                <div class="col-12">
                                                    <div class="p-3 border bg-light">
                                                        <div class="row g-3">
                                                            <div class="col-md-3">
                                                                <label for="tipoProducto" class="form-label">Tipo de
                                                                    Producto</label>
                                                                <select class="form-select" id="tipoProducto"
                                                                    [(ngModel)]="newPlan.tipoProducto"
                                                                    name="tipoProducto" required>
                                                                    <option selected disabled value="">Seleccione...
                                                                    </option>
                                                                    <option value="tipo1">Estandar</option>
                                                                    <option value="tipo2">Avanzado</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="familia" class="form-label">Familia</label>
                                                                <select class="form-select" id="familia"
                                                                    [(ngModel)]="newPlan.familia" name="familia"
                                                                    required>
                                                                    <option selected disabled value="">Seleccione...
                                                                    </option>
                                                                    <option value="familia1">Movil</option>
                                                                    <option value="familia2">IoT</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="producto"
                                                                    class="form-label">Producto</label>
                                                                <select class="form-select" id="producto"
                                                                    [(ngModel)]="newPlan.producto" name="producto"
                                                                    required>
                                                                    <option selected disabled value="">Seleccione...
                                                                    </option>
                                                                    <option value="producto1">Pospago Empresarial
                                                                    </option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="plan" class="form-label">Plan</label>
                                                                <select class="form-select" id="plan"
                                                                    [(ngModel)]="newPlan.plan" name="plan" required>
                                                                    <option selected disabled value="">Seleccione...
                                                                    </option>
                                                                    <option value="plan1">Plan 1</option>
                                                                    <option value="plan2">Plan 2</option>
                                                                    <option value="plan3">Plan 3</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="cantidad"
                                                                    class="form-label">Cantidad</label>
                                                                <input type="number" class="form-control" id="cantidad"
                                                                    [(ngModel)]="newPlan.cantidad" name="cantidad"
                                                                    required>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="valorUnitario" class="form-label">Valor
                                                                    Unitario</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" class="form-control"
                                                                        id="valorUnitario"
                                                                        [(ngModel)]="newPlan.valorUnitario"
                                                                        name="valorUnitario">
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="grupo" class="form-label">Grupo</label>
                                                                <input type="text" class="form-control" id="grupo"
                                                                    [(ngModel)]="newPlan.grupo" name="grupo">
                                                            </div>



                                                            <!-- Tipo de Envío -->
                                                            <div class="col-md-3">
                                                                <label for="tipoEnvio" class="form-label">Tipo de
                                                                    Envío</label>
                                                                <select class="form-select" id="newLineaTipoEnvio"
                                                                    [(ngModel)]="newPlan.tipoEnvio"
                                                                    name="newLineaTipoEnvio">
                                                                    <option selected disabled value="SIN OPERADOR">
                                                                        Seleccione...
                                                                    </option>
                                                                    <option value="OPERADOR LOGÍSTICO">OPERADOR
                                                                        LOGÍSTICO
                                                                    </option>
                                                                    <option value="ENTREGA POR COMERCIAL">ENTREGA POR
                                                                        COMERCIAL
                                                                    </option>
                                                                </select>
                                                            </div>



                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="p-3 border bg-light">
                                                        <div class="row g-3">

                                                            <div class="col-md-4">
                                                                <label for="codigoPromocion"
                                                                    class="form-label">Descuento Campaña</label>
                                                                <select class="form-select" id="codigoPromocion"
                                                                    [(ngModel)]="newPlan.idPromocion"
                                                                    name="codigoPromocion" required>
                                                                    <option selected value="Sin campaña">Sin campaña
                                                                    </option>
                                                                    <option value="Campaña 1">Campaña 1
                                                                    </option>
                                                                    <option value="Campaña 2">Campaña 2
                                                                    </option>
                                                                    <option value="Campaña 3">Campaña 3</option>
                                                                </select>

                                                            </div>

                                                            <div class="col-md-4"
                                                                *ngIf="newContract.contract.tipoContrato==='Negociado'">
                                                                <label for="valorDescuento" class="form-label">Descuento
                                                                    Personalizado</label>
                                                                <div class="input-group">
                                                                    <input type="number" class="form-control"
                                                                        id="valorDescuento"
                                                                        [(ngModel)]="newPlan.valorDescuento"
                                                                        name="valorDescuento" step="0.01" required>
                                                                    <span class="input-group-text">%</span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-4"
                                                                *ngIf="newContract.contract.tipoContrato==='Negociado'">
                                                                <label for="motivoDescuento" class="form-label">Motivo
                                                                    del Descuento</label>
                                                                <select class="form-select" id="motivoDescuento"
                                                                    [(ngModel)]="newPlan.motivoDescuento"
                                                                    name="motivoDescuento" required>
                                                                    <option selected disabled value="">Seleccione...
                                                                    </option>
                                                                    <option value="motivo1">Descuento Comercial
                                                                    </option>
                                                                    <option value="motivo2">Descuento por Retención
                                                                    </option>
                                                                    <option value="motivo3">Descuento por renovacion
                                                                        comercial</option>
                                                                </select>
                                                            </div>

                                                            <div *ngIf="newContract.contract.tipoContrato==='Estandar'"
                                                                class="col-md-8 alert alert-info">
                                                                La configuración de descuentos personalizados solo
                                                                corresponde a los
                                                                contratos negociados
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="p-3 border bg-light">
                                                        <div class="row g-3">



                                                            <div class="col-md-4">
                                                                <div class="input-group">
                                                                    <select class="form-select"
                                                                        [(ngModel)]="addService.tipo"
                                                                        name="addServiceTipo" id="addServiceTipo">
                                                                        <option selected disabled value="">
                                                                            Seleccione...
                                                                        </option>
                                                                        <option value="voz-sms">
                                                                            Voz/SMS</option>
                                                                        <option value="roaming1">
                                                                            Roaming 1</option>
                                                                        <option value="roaming2">
                                                                            Roaming 2</option>
                                                                        <option value="ldi">LDI
                                                                        </option>
                                                                        <option value="numeroPrivado">
                                                                            Número Privado</option>
                                                                    </select>
                                                                </div>
                                                            </div>

                                                            <div class="col-md-4">

                                                                <div class="input-group">
                                                                    <input type="number" class="form-control"
                                                                        id="porcentajeDescuentoAddService"
                                                                        name="porcentajeDescuentoAddService"
                                                                        [(ngModel)]="addService.descuento" required>
                                                                    <span class="input-group-text">%</span>
                                                                </div>
                                                            </div>

                                                            <div class="col-md-4">
                                                                <button class="btn btn-primary" type="button"
                                                                    (click)="adicionarServicioAdicional()">Adicionar
                                                                    Servicio</button>

                                                            </div>



                                                            <div class="col-12">
                                                                <div class="table-responsive">
                                                                    <table class="table table-striped table-hover"
                                                                        id="tablaServiciosAdicionales">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Servicio Adicional</th>
                                                                                <th>Cargo Básico</th>
                                                                                <th>% Descuento</th>
                                                                                <th></th>

                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr
                                                                                *ngFor="let servicio of newContract.addServices; let i = index">
                                                                                <td>{{ servicio.tipo }}</td>
                                                                                <td>{{ servicio.cargoBasico }}</td>
                                                                                <td>{{ servicio.descuento }}</td>
                                                                                <td>
                                                                                    <button
                                                                                        class="btn btn-danger btn-sm"
                                                                                        (click)="eliminarServicioAdicional(i)">Eliminar</button>
                                                                                </td>
                                                                                <td>

                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="p-3 border bg-light">
                                                        <div class="row g-3">

                                                            <div class="col-3">

                                                            </div>

                                                            <div class="col-6">
                                                                <h5 class="text-end"
                                                                    *ngIf="newPlan.cantidad >0 && newPlan.valorUnitario>0 ">
                                                                    Valor Total sin Impuesto $ {{
                                                                    newPlan.cantidad * ( newPlan.valorUnitario +
                                                                    calcularTotalCargosServiciosAdicionales() )
                                                                    }}</h5>
                                                            </div>

                                                            <div class="col-md-3 text-end">
                                                                <button class="btn btn-primary"
                                                                    (click)="agregarPlan()">Adicionar</button>
                                                            </div>


                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="p-3 border bg-light">
                                                        <div class="row g-3">

                                                            <div class="table-responsive">
                                                                <table class="table table-striped table-hover">
                                                                    <thead>
                                                                        <tr>
                                                                            <th scope="col">Seleccione Plan</th>
                                                                            <th scope="col">Grupo</th>
                                                                            <th scope="col">Plan</th>
                                                                            <th scope="col">Cantidad</th>
                                                                            <th scope="col"></th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr
                                                                            *ngFor="let plan of showedPlans; ; let j = index">

                                                                            <td>

                                                                                <input type="radio" name="selectPlan"
                                                                                    [value]="(j + 1)"
                                                                                    [(ngModel)]="selectedPlanId"
                                                                                    (change)="selectPlan(j + 1)">

                                                                            </td>

                                                                            <td>{{ plan.grupo }}</td>
                                                                            <td>{{ plan.plan }}</td>
                                                                            <td>{{ plan.cantidad }}</td>
                                                                            <td>
                                                                                <button class="btn btn-danger btn-sm"
                                                                                    (click)="eliminarPlan(j)">Eliminar</button>

                                                                            </td>
                                                                        </tr>

                                                                    </tbody>
                                                                </table>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="card mt-2">
                                        <div class="card-header">
                                            Líneas a activar
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <!-- Tipo Línea -->
                                                <div class="col-md-3">
                                                    <label for="tipoLinea" class="form-label">Tipo Línea</label>
                                                    <select class="form-select" [(ngModel)]="newLinea.tipoLinea"
                                                        name="newLineaTipoLinea">
                                                        <option selected disabled value="">Seleccione...</option>
                                                        <option value="Linea Nueva">Linea Nueva</option>
                                                        <option value="Prepago a Pospago">Prepago a Pospago</option>
                                                        <option value="Portabilidad">Portabilidad</option>
                                                        <option value="Portabilidad Con Cesión De Contrato">Portabilidad
                                                            Con Cesión De Contrato</option>
                                                    </select>
                                                </div>
                                                <!-- Línea -->
                                                <div class="col-md-3">
                                                    <label for="linea" class="form-label">Numero de Línea</label>
                                                    <input type="number" class="form-control" id="newLineaNumeroLinea"
                                                        [(ngModel)]="newLinea.numeroLinea" name="newLineaNumeroLinea">
                                                </div>
                                                <!-- IMSI -->
                                                <div class="col-md-3">
                                                    <label for="imsi" class="form-label">IMSI</label>
                                                    <input type="number" class="form-control" id="newLineaImsi"
                                                        [(ngModel)]="newLinea.imsi" name="newLineaImsi">
                                                </div>
                                                <!-- IMEI -->
                                                <div class="col-md-3">
                                                    <label for="imei" class="form-label">IMEI</label>
                                                    <input type="text" class="form-control" id="newLineaImei"
                                                        [(ngModel)]="newLinea.imei" name="newLineaImei">
                                                </div>
                                                <!-- Operador -->
                                                <div class="col-md-3">
                                                    <label for="operador" class="form-label">Operador</label>
                                                    <select class="form-select" [(ngModel)]="newLinea.operador"
                                                        name="newLineaOperador" id="newLineaOperador">
                                                        <option selected disabled value="">Seleccione...</option>
                                                        <option value="Claro">Claro</option>
                                                        <option value="Movistar">Movistar</option>
                                                        <option value="Wom">Wom</option>
                                                    </select>
                                                </div>
                                                <!-- Tipo Persona -->
                                                <div class="col-md-3">
                                                    <label for="tipoPersona" class="form-label">Tipo Persona</label>
                                                    <select class="form-select" id="newLineaTipoPersona"
                                                        [(ngModel)]="newLinea.tipoPersona" name="newLineaTipoPersona">
                                                        <option selected disabled value="">Seleccione...</option>
                                                        <option value="NATURAL">NATURAL</option>
                                                        <option value="JURÍDICO">JURÍDICO</option>
                                                    </select>
                                                </div>
                                                <!-- Tipo de Identificación -->
                                                <div class="col-md-3">
                                                    <label for="tipoIdentificacion" class="form-label">Tipo de
                                                        Identificación</label>
                                                    <select class="form-select" id="newLineaTipoIdentificacion"
                                                        [(ngModel)]="newLinea.tipoIdentificacion"
                                                        name="newLineaTipoIdentificacion">
                                                        <option selected disabled value="">Seleccione...</option>
                                                        <option value="CC">CC</option>
                                                        <option value="NIT">NIT</option>
                                                        <option value="CE">CE</option>
                                                    </select>
                                                </div>
                                                <!-- Número Documento -->
                                                <div class="col-md-3">
                                                    <label for="numeroDocumento" class="form-label">Número
                                                        Documento</label>
                                                    <input type="number" class="form-control"
                                                        id="newLineanumeroDocumento"
                                                        [(ngModel)]="newLinea.numeroDocumento"
                                                        name="newLineanumeroDocumento">
                                                </div>
                                                <!-- Nombre -->
                                                <div class="col-md-3">
                                                    <label for="nombre" class="form-label">Nombre</label>
                                                    <input type="text" class="form-control" id="newLineaNombre"
                                                        [(ngModel)]="newLinea.nombre" name="newLineaNombre">
                                                </div>
                                                <!-- Fecha de Expedición -->
                                                <div class="col-md-3">
                                                    <label for="fechaExpedicion" class="form-label">Fecha de
                                                        Expedición</label>
                                                    <input type="number" class="form-control"
                                                        id="newLineaFechaExpedicion"
                                                        [(ngModel)]="newLinea.fechaExpedicion"
                                                        name="newLineaFechaExpedicion">
                                                </div>


                                            </div>
                                        </div>

                                        <div class="card-footer text-end">
                                            <button class="btn btn-primary" type="button"
                                                (click)="adicionarLinea()">Adicionar Línea</button>

                                        </div>


                                    </div>
                                </div>
                                <div class="tab-pane fade" id="registro-equipos" role="tabpanel"
                                    aria-labelledby="registro-equipos-tab">
                                    <div class="card mt-2">
                                        <div class="card-header">
                                            Registro de Equipos
                                        </div>
                                        <div class="card-body">


                                            <div *ngIf="newContract.contract.tipoContrato==='Estandar'"
                                                class="alert alert-info">
                                                La redención de equipos pertenece a los contratos Negociados.
                                            </div>

                                            <div class="row g-2"
                                                *ngIf="newContract.contract.tipoContrato==='Negociado'">

                                                <div class="col-12">
                                                    <div class="p-3 border bg-light">

                                                        <div class="row g-3">
                                                            <div class="col-md-3">
                                                                <label for="redencionEquipos"
                                                                    class="form-label">Redención de
                                                                    Equipos</label>
                                                                <select class="form-select" id="redencionEquipos"
                                                                    name="redencionEquipos"
                                                                    [(ngModel)]="nuevoEquipo.redencionEquipos" required>
                                                                    <option selected disabled value="">Seleccione...
                                                                    </option>
                                                                    <option value="SI">SI</option>
                                                                    <option value="NO">NO</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="equipo" class="form-label">Equipo</label>
                                                                <select class="form-select" id="equipo" name="equipo"
                                                                    [(ngModel)]="nuevoEquipo.equipo" required>
                                                                    <option selected disabled value="">Seleccione...
                                                                    </option>
                                                                    <option value="equipo1">Equipo 1</option>
                                                                    <option value="equipo2">Equipo 2</option>
                                                                </select>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="cantidadInventario"
                                                                    class="form-label">Cantidad en
                                                                    Inventario</label>
                                                                <input type="number" class="form-control"
                                                                    id="cantidadInventario" name="cantidadInventario"
                                                                    [(ngModel)]="nuevoEquipo.cantidadInventario"
                                                                    readonly>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="cantidad"
                                                                    class="form-label">Cantidad</label>
                                                                <input type="number" class="form-control" id="cantidad"
                                                                    name="cantidad" [(ngModel)]="nuevoEquipo.cantidad"
                                                                    required>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="valorEquipo" class="form-label">Valor
                                                                    (sin
                                                                    IVA)</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" class="form-control"
                                                                        id="valorEquipo" name="valorEquipo"
                                                                        [(ngModel)]="nuevoEquipo.valorEquipo" required>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="porcentajeDescuento" class="form-label">%
                                                                    Descuento</label>
                                                                <div class="input-group">
                                                                    <input type="number" class="form-control"
                                                                        id="porcentajeDescuento"
                                                                        name="porcentajeDescuento"
                                                                        [(ngModel)]="nuevoEquipo.porcentajeDescuento"
                                                                        required>
                                                                    <span class="input-group-text">%</span>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <label for="valorDescontado" class="form-label">Valor
                                                                    Descontado</label>
                                                                <div class="input-group">
                                                                    <span class="input-group-text">$</span>
                                                                    <input type="number" class="form-control"
                                                                        id="valorDescontado" name="valorDescontado"
                                                                        [(ngModel)]="nuevoEquipo.valorDescontado"
                                                                        required>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-12">
                                                    <div class="p-3 border bg-light">
                                                        <div class="row g-3">

                                                            <div class="col-3">

                                                            </div>

                                                            <div class="col-6">
                                                                <h5 class="text-end">Saldo $ {{
                                                                    newContract.contract.saldo }}</h5>
                                                            </div>

                                                            <div class="col-md-3 text-end">
                                                                <button type="button" class="btn btn-primary"
                                                                    (click)="adicionarEquipo()">Adicionar
                                                                    Equipo</button>

                                                            </div>


                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <div class="p-3 border bg-light">
                                                        <div class="row g-3">
                                                            <div class="table-responsive">
                                                                <table class="table table-striped table-hover">
                                                                    <thead>
                                                                        <tr>
                                                                            <th>Equipo</th>
                                                                            <th>Cantidad en Inventario</th>
                                                                            <th>Cantidad</th>
                                                                            <th>Valor del Equipo</th>
                                                                            <th>% Descuento</th>
                                                                            <th>Valor Descontado</th>
                                                                            <th>Redención de Equipos</th>
                                                                            <th>Acciones</th>
                                                                        </tr>
                                                                    </thead>
                                                                    <tbody>
                                                                        <tr
                                                                            *ngFor="let equipo of newContract.devices; let i = index">
                                                                            <td>{{ equipo.equipo }}</td>
                                                                            <td>{{ equipo.cantidadInventario }}</td>
                                                                            <td>{{ equipo.cantidad }}</td>
                                                                            <td>{{ equipo.valorEquipo | currency }}
                                                                            </td>
                                                                            <td>{{ equipo.porcentajeDescuento }}%
                                                                            </td>
                                                                            <td>{{ equipo.valorDescontado | currency
                                                                                }}</td>
                                                                            <td>{{ equipo.redencionEquipos }}</td>
                                                                            <td>
                                                                                <button class="btn btn-danger btn-sm"
                                                                                    (click)="eliminarEquipo(i)">Eliminar</button>
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>

                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="resumen-venta" role="tabpanel"
                                    aria-labelledby="resumen-venta-tab">
                                    <div class="card mt-2">
                                        <div class="card-header">
                                            Resumen antes de activación
                                        </div>
                                        <div class="card-body">
                                            <div class="card-title"> </div>

                                            <div class="row g-2">

                                                <div class="col-md-4">
                                                    <p id="numeroContratoResume">Número Contrato: {{
                                                        newContract.contract.numeroContrato }}</p>
                                                </div>

                                                <div class="col-md-4">
                                                    <p id="tipoContrato">Tipo Contrato: {{
                                                        newContract.contract.tipoContrato }}</p>
                                                </div>

                                                <div class="col-md-4">
                                                    <p id="inicioVigencia">Inicio de Vigencia: {{
                                                        newContract.contract.inicioVigencia | date: 'dd/MM/yyyy' }}
                                                    </p>
                                                </div>

                                                <div class="col-md-4">

                                                    <p id="mesesContrato">Meses de Contrato: {{
                                                        newContract.contract.mesesContrato > 0
                                                        ?newContract.contract.mesesContrato : ''}}</p>
                                                </div>

                                                <div class="col-md-4">

                                                    <p id="finVigencia">Fin de Vigencia: {{
                                                        newContract.contract.finVigencia | date: 'dd/MM/yyyy' }}</p>
                                                </div>

                                                <div class="col-md-4">

                                                    <p id="codigoVendedor">Identificación del KAM: {{
                                                        newContract.contract.codigoVendedor > 0 ?
                                                        newContract.contract.codigoVendedor : '' }}</p>
                                                </div>

                                                <div class="col-12">
                                                    <div class="alert alert-info">
                                                        El detalle de planes y lineas no contiene los descuentos por
                                                        promociones y/o masivos aplicados.
                                                    </div>
                                                </div>

                                                <div class="col-12">
                                                    <ul class="nav nav-tabs" id="myResumeTab" role="tablist">
                                                        <li class="nav-item" role="presentation">
                                                            <button class="nav-link active" id="tab1-tab"
                                                                data-bs-toggle="tab" data-bs-target="#planes_tab"
                                                                type="button" role="tab" aria-controls="tab1"
                                                                aria-selected="true">Planes</button>
                                                        </li>
                                                        <li class="nav-item" role="presentation">
                                                            <button class="nav-link" id="tab2-tab" data-bs-toggle="tab"
                                                                data-bs-target="#lineas_tab" type="button" role="tab"
                                                                aria-controls="tab2"
                                                                aria-selected="false">Lineas</button>
                                                        </li>
                                                        <li class="nav-item" role="presentation">
                                                            <button class="nav-link" id="tab4-tab" data-bs-toggle="tab"
                                                                data-bs-target="#portabilidad_tab" type="button"
                                                                role="tab" aria-controls="tab4"
                                                                aria-selected="false">Portabilidad</button>
                                                        </li>
                                                        <li class="nav-item" role="presentation">
                                                            <button class="nav-link" id="tab3-tab" data-bs-toggle="tab"
                                                                data-bs-target="#devices_tab" type="button" role="tab"
                                                                aria-controls="tab3"
                                                                aria-selected="false">Equipos</button>
                                                        </li>
                                                    </ul>
                                                    <div class="tab-content" id="myTabContent">
                                                        <div class="tab-pane fade show active" id="planes_tab"
                                                            role="tabpanel" aria-labelledby="tab1-tab">

                                                            <div class="row mt-3" *ngIf="newContract.plans.length > 0">



                                                                <div class="table-responsive">
                                                                    <table class="table table-striped table-hover">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Grupo</th>
                                                                                <th>Id Cuenta</th>
                                                                                <th>Plan</th>
                                                                                <th>Cantidad de líneas</th>
                                                                                <th>Descuento Personalizado</th>
                                                                                <th>Motivo Descuento Personalizado</th>
                                                                                <th>Tarifa unitaria Cargo Básico</th>
                                                                                <th>Precio Unitario con Descuento - IVA
                                                                                </th>
                                                                                <th>Precio Unitario con Descuento + IVA
                                                                                </th>
                                                                                <th>Precio Total con Descuento - IVA
                                                                                </th>
                                                                                <th>Precio Total con Descuento + IVA
                                                                                </th>
                                                                                <th>Campaña</th>
                                                                                <th>Tipo de Envío</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr
                                                                                *ngFor="let finalPlan of newContract.plans; let i = index">
                                                                                <td>{{ finalPlan.grupo }}</td>
                                                                                <td>{{ finalPlan.idCuentaFacturacion }}
                                                                                </td>
                                                                                <td>{{ finalPlan.plan }}</td>
                                                                                <td>{{ finalPlan.cantidad }}</td>
                                                                                <td>{{ finalPlan.valorDescuento }}</td>
                                                                                <td>{{ finalPlan.motivoDescuento ?
                                                                                    finalPlan.motivoDescuento : '' }}
                                                                                </td>
                                                                                <td>{{ finalPlan.valorUnitario }}</td>
                                                                                <td>{{ finalPlan.valorUnitario * (1 -
                                                                                    (finalPlan.valorDescuento / 100)) }}
                                                                                </td>
                                                                                <td>{{ finalPlan.valorUnitario * (1 -
                                                                                    (finalPlan.valorDescuento / 100)) *
                                                                                    (1 + ivaTax.value) }}
                                                                                </td>
                                                                                <td>{{ finalPlan.valorUnitario * (1 -
                                                                                    (finalPlan.valorDescuento / 100)) *
                                                                                    finalPlan.cantidad
                                                                                    }}</td>
                                                                                <td>{{ finalPlan.valorUnitario * (1 -
                                                                                    (finalPlan.valorDescuento / 100)) *
                                                                                    finalPlan.cantidad * (1 +
                                                                                    ivaTax.value)
                                                                                    }}</td>
                                                                                <td>{{ finalPlan.idPromocion }}</td>
                                                                                <td>{{ finalPlan.tipoEnvio }}</td>
                                                                            </tr>

                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>

                                                        </div>
                                                        <div class="tab-pane fade" id="lineas_tab" role="tabpanel"
                                                            aria-labelledby="tab2-tab">
                                                            <div class="row mt-3" *ngIf="newContract.lineas.length > 0">
                                                                <div class="table-responsive">
                                                                    <table class="table table-striped">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Tipo Línea</th>
                                                                                <th>Número Línea</th>
                                                                                <th>IMSI</th>
                                                                                <th>IMEI</th>
                                                                                <th>Grupo</th>
                                                                                <th>Plan</th>
                                                                                <th>Tarifa unitaria Cargo Básico</th>
                                                                                <th>Descuento Personalizado</th>
                                                                                <th>Campaña</th>
                                                                                <th>Tipo Envio</th>
                                                                                <th>Acciones</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr
                                                                                *ngFor="let linea of newContract.lineas; let i = index">
                                                                                <td>{{ linea.tipoLinea }}</td>
                                                                                <td>{{ linea.numeroLinea }}</td>
                                                                                <td>{{ linea.imsi }}</td>
                                                                                <td>{{ linea.imei }}</td>

                                                                                <td>{{ linea.grupo }}</td>
                                                                                <td>{{ linea.plan }}</td>
                                                                                <td>{{ linea.valorUnitario }}</td>
                                                                                <td>{{ linea.valorDescuento &&
                                                                                    linea.valorDescuento > 0 ?
                                                                                    linea.valorDescuento : 'NO APLICA'}}
                                                                                </td>
                                                                                <td>{{ linea.idPromocion }}</td>
                                                                                <td>{{ linea.tipoEnvio }}</td>

                                                                                <td>
                                                                                    <button
                                                                                        class="btn btn-danger btn-sm"
                                                                                        (click)="eliminarLinea(i)">Eliminar</button>
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="tab-pane fade" id="portabilidad_tab" role="tabpanel"
                                                            aria-labelledby="tab4-tab">
                                                            <div class="row mt-3" *ngIf="portableLines.length > 0">
                                                                <div class="table-responsive">
                                                                    <table class="table table-striped">
                                                                        <thead>
                                                                            <tr>
                                                                                <th>Número Línea</th>
                                                                                <th>Operador</th>
                                                                                <th>Tipo Persona</th>
                                                                                <th>Tipo Identificación</th>
                                                                                <th>Número Documento</th>
                                                                                <th>Nombre</th>
                                                                                <th>Fecha Expedición</th>
                                                                            </tr>
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr
                                                                                *ngFor="let linea of portableLines; let i = index">
                                                                                <td>{{ linea.numeroLinea }}</td>
                                                                                <td>{{ linea.operador }}</td>
                                                                                <td>{{ linea.tipoPersona }}</td>
                                                                                <td>{{ linea.tipoIdentificacion }}</td>
                                                                                <td>{{ linea.numeroDocumento }}</td>
                                                                                <td>{{ linea.nombre }}</td>
                                                                                <td>{{ linea.fechaExpedicion }}</td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="tab-pane fade" id="devices_tab" role="tabpanel"
                                                            aria-labelledby="tab3-tab">

                                                            <div class="container"
                                                                *ngIf="newContract.devices.length > 0">



                                                                <div class="row">
                                                                    <div class="table-responsive">
                                                                        <table class="table table-striped table-hover">
                                                                            <thead>
                                                                                <tr>
                                                                                    <th>Equipo</th>
                                                                                    <th>Cantidad</th>
                                                                                    <th>Valor Descontado</th>
                                                                                    <th>Redención de Equipos</th>
                                                                                </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                                <tr
                                                                                    *ngFor="let equipo of newContract.devices; let i = index">
                                                                                    <td>{{ equipo.equipo }}</td>
                                                                                    <td>{{ equipo.cantidad }}</td>

                                                                                    <td>{{ equipo.valorDescontado |
                                                                                        currency
                                                                                        }}</td>
                                                                                    <td>{{ equipo.redencionEquipos }}
                                                                                    </td>
                                                                                </tr>
                                                                            </tbody>
                                                                        </table>
                                                                    </div>

                                                                </div>

                                                                <div class="row">

                                                                    <h5>El valor definido en la bolsa es: {{
                                                                        newContract.contract.valorBolsa | currency }}.
                                                                    </h5>

                                                                </div>

                                                                <div class="row">
                                                                    <h5>El saldo pendiente por redimir es: {{
                                                                        newContract.contract.saldo | currency }}.</h5>

                                                                </div>



                                                            </div>



                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-footer text-end">
            <button type="button" class="btn btn-primary">GUARDAR</button>
            <button type="button" class="btn btn-success">ACTIVAR</button>
        </div>

    </form>
</div>