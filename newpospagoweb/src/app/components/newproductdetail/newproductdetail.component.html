<div class="card">

    <div #modal></div>
    <div #sucessModal></div>

    <div class="card-body">
        <h5 class="card-title  text-center">
            Detalle - Nuevo Pospago B2B
        </h5>

        <div>

            <div class="card">

                <div class="card-body">
                    <h5 class="card-title  text-center">Cliente: {{ this.documentNumberParam }} - {{
                        this.legalNameParam }}</h5>

                    <div class="container">


                        <div class="row g-1">
                            <div class="col-12">
                                <div class="p-3 border bg-light">
                                    <div class="row g-1">

                                        <div class="col-md-4">
                                            <p id="numeroContratoResume">Número Contrato: {{
                                                newContract && newContract.contract ?
                                                newContract.contract.numeroContrato : '' }}</p>
                                        </div>

                                        <div class="col-md-4">
                                            <p id="tipoContrato">Tipo Contrato: {{
                                                newContract && newContract.contract ? newContract.contract.tipoContrato
                                                : ''}}</p>
                                        </div>

                                        <div class="col-md-4">
                                            <p id="inicioVigencia">Inicio de Vigencia: {{
                                                newContract && newContract.contract ?
                                                (newContract.contract.inicioVigencia | date:
                                                'dd/MM/yyyy') : '' }}
                                            </p>
                                        </div>

                                        <div class="col-md-4">

                                            <p id="mesesContrato">Meses de Contrato: {{
                                                newContract && newContract.contract ?
                                                (newContract.contract.mesesContrato > 0
                                                ?newContract.contract.mesesContrato : '') : '' }}</p>
                                        </div>

                                        <div class="col-md-4">

                                            <p id="finVigencia">Fin de Vigencia: {{
                                                newContract && newContract.contract ? (newContract.contract.finVigencia
                                                | date:
                                                'dd/MM/yyyy') : '' }}</p>
                                        </div>

                                        <div class="col-md-4">

                                            <p id="codigoVendedor">Identificación del KAM: {{
                                                newContract && newContract.contract ?
                                                (newContract.contract.codigoVendedor > 0 ?
                                                newContract.contract.codigoVendedor : '') : '' }}</p>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div class="col-12" *ngIf="newContract && newContract.contract && newContract.billAccounts.length>0">
                                <div class="p-3 border bg-light">

                                    <div class="row g-1">
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">Id cuenta</th>
                                                        <th scope="col"># Cuenta Facturación
                                                        </th>
                                                        <th scope="col">Ciclo de Facturación
                                                        </th>
                                                        <th scope="col">Fecha de creación</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr *ngFor="let cuenta of newContract.billAccounts; let i = index">

                                                        <td>{{ cuenta.cuentaFacturacion ?
                                                            cuenta.cuentaFacturacion : "NUEVA " +
                                                            cuenta.id }}</td>
                                                        <td>{{ cuenta.cuentaFacturacion ?
                                                            cuenta.cuentaFacturacion :
                                                            "PENDIENTE" }}</td>
                                                        <td>{{ cuenta.cicloFacturacion ?
                                                            cuenta.cicloFacturacion :
                                                            "PENDIENTE" }}</td>
                                                        <td>{{ cuenta.fechaCreacion ?
                                                            ( cuenta.fechaCreacion | date:
                                                            'dd/MM/yyyy' ) :
                                                            "PENDIENTE" }}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="col-12">
                                <div class="p-3 border bg-light">
                                    <div class="row g-1">

                                        <ul class="nav nav-tabs" id="myResumeTab" role="tablist">
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link active" id="tab1-tab" data-bs-toggle="tab"
                                                    data-bs-target="#planes_tab" type="button" role="tab"
                                                    aria-controls="tab1" aria-selected="true">Productos</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="tab2-tab" data-bs-toggle="tab"
                                                    data-bs-target="#lineas_tab" type="button" role="tab"
                                                    aria-controls="tab2" aria-selected="false">Lineas</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="tab4-tab" data-bs-toggle="tab"
                                                    data-bs-target="#portabilidad_tab" type="button" role="tab"
                                                    aria-controls="tab4" aria-selected="false">Detalle
                                                    Portabilidad</button>
                                            </li>
                                            <li class="nav-item" role="presentation">
                                                <button class="nav-link" id="tab3-tab" data-bs-toggle="tab"
                                                    data-bs-target="#devices_tab" type="button" role="tab"
                                                    aria-controls="tab3" aria-selected="false">Equipos</button>
                                            </li>
                                        </ul>
                                        <div class="tab-content" id="myTabContent">
                                            <div class="tab-pane fade show active" id="planes_tab" role="tabpanel"
                                                aria-labelledby="tab1-tab">

                                                <div class="row mt-3"
                                                    *ngIf="newContract && newContract.plans.length > 0">



                                                    <div class="table-responsive">
                                                        <table class="table table-striped table-hover">
                                                            <thead>
                                                                <tr>

                                                                    <th>Cuenta Facturación</th>
                                                                    <th>Plan</th>
                                                                    <th>Cantidad de líneas</th>
                                                                    <th>Descuento Personalizado
                                                                    </th>
                                                                    <th>Motivo Descuento
                                                                        Personalizado
                                                                    </th>
                                                                    <th>Tarifa unitaria Cargo
                                                                        Básico
                                                                    </th>
                                                                    <th>Precio Unitario con
                                                                        Descuento -
                                                                        IVA
                                                                    </th>
                                                                    <th>Precio Unitario con
                                                                        Descuento +
                                                                        IVA
                                                                    </th>
                                                                    <th>Precio Total con
                                                                        Descuento - IVA
                                                                    </th>
                                                                    <th>Precio Total con
                                                                        Descuento + IVA
                                                                    </th>
                                                                    <th>Campaña</th>
                                                                    <th>Tipo de Envío</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr
                                                                    *ngFor="let finalPlan of newContract.plans; let i = index">

                                                                    <td>{{
                                                                        finalPlan.cuentaFacturacion
                                                                        ?
                                                                        finalPlan.cuentaFacturacion
                                                                        : "NUEVA " +
                                                                        finalPlan.idCuentaFacturacion
                                                                        }}
                                                                    </td>
                                                                    <td>{{ finalPlan.plan }}
                                                                    </td>
                                                                    <td>{{ finalPlan.cantidad }}
                                                                    </td>
                                                                    <td>{{
                                                                        finalPlan.valorDescuento
                                                                        }}
                                                                    </td>
                                                                    <td>{{
                                                                        finalPlan.motivoDescuento
                                                                        ?
                                                                        finalPlan.motivoDescuento
                                                                        : 'NO APLICA'
                                                                        }}
                                                                    </td>
                                                                    <td>{{
                                                                        finalPlan.valorUnitario
                                                                        }}
                                                                    </td>
                                                                    <td>{{
                                                                        finalPlan.valorUnitario
                                                                        * (1
                                                                        -
                                                                        (finalPlan.valorDescuento
                                                                        /
                                                                        100)) }}
                                                                    </td>
                                                                    <td>{{
                                                                        finalPlan.valorUnitario
                                                                        * (1
                                                                        -
                                                                        (finalPlan.valorDescuento
                                                                        /
                                                                        100)) *
                                                                        (1 + ivaTax.value) }}
                                                                    </td>
                                                                    <td>{{
                                                                        finalPlan.valorUnitario
                                                                        * (1
                                                                        -
                                                                        (finalPlan.valorDescuento
                                                                        /
                                                                        100)) *
                                                                        finalPlan.cantidad
                                                                        }}</td>
                                                                    <td>{{
                                                                        finalPlan.valorUnitario
                                                                        * (1
                                                                        -
                                                                        (finalPlan.valorDescuento
                                                                        /
                                                                        100)) *
                                                                        finalPlan.cantidad * (1
                                                                        +
                                                                        ivaTax.value)
                                                                        }}</td>
                                                                    <td>{{ finalPlan.idPromocion
                                                                        }}</td>
                                                                    <td>{{ finalPlan.tipoEnvio
                                                                        }}</td>
                                                                </tr>

                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>

                                            </div>
                                            <div class="tab-pane fade" id="lineas_tab" role="tabpanel"
                                                aria-labelledby="tab2-tab">
                                                <div class="row mt-3"
                                                    *ngIf="newContract && newContract.lineas.length > 0">
                                                    <div class="table-responsive">
                                                        <table class="table table-striped">
                                                            <thead>
                                                                <tr>
                                                                    <th>Tipo Línea</th>
                                                                    <th>MSISDN</th>
                                                                    <th>IMSI</th>
                                                                    <th>IMEI</th>
                                                                    <th>Grupo</th>
                                                                    <th>Plan</th>
                                                                    <th>Tarifa unitaria Cargo Básico
                                                                    </th>
                                                                    <th>Descuento Personalizado</th>
                                                                    <th>Motivo Descuento</th>
                                                                    <th>Precio Unitario con
                                                                        Descuento - IVA</th>
                                                                    <th>Precio Unitario con
                                                                        Descuento + IVA</th>
                                                                    <th>Campaña</th>
                                                                    <th>Tipo Envio</th>

                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr
                                                                    *ngFor="let linea of newContract.lineas; let i = index">
                                                                    <td>{{ linea.tipoLinea }}</td>
                                                                    <td>{{ linea.numeroLinea }}</td>
                                                                    <td>{{ linea.imsi }}</td>
                                                                    <td>{{ linea.imei }}</td>
                                                                    <td>{{ linea.grupo }}</td>
                                                                    <td>{{ linea.plan }}</td>
                                                                    <td>{{ linea.valorUnitario }}
                                                                    </td>
                                                                    <td>{{ linea.valorDescuento }}
                                                                    </td>
                                                                    <td>{{ linea.motivoDescuento ?
                                                                        linea.motivoDescuento : 'NO APLICA'}}</td>
                                                                    <td>{{ linea.valorUnitario ?
                                                                        (linea.valorDescuento ?
                                                                        (linea.valorUnitario * (1 -
                                                                        (linea.valorDescuento / 100
                                                                        ))) : linea.valorUnitario) :
                                                                        0 }}</td>
                                                                    <td>{{ linea.valorUnitario ?
                                                                        (linea.valorDescuento ?
                                                                        ((linea.valorUnitario * (1 -
                                                                        (linea.valorDescuento / 100
                                                                        ))) * (1 + ivaTax.value)):
                                                                        (linea.valorUnitario * (1 +
                                                                        ivaTax.value))) : 0 }}</td>
                                                                    <td>{{ linea.idPromocion }}</td>
                                                                    <td>{{ linea.tipoEnvio }}</td>


                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="portabilidad_tab" role="tabpanel"
                                                aria-labelledby="tab4-tab">
                                                <div class="row mt-3" *ngIf="portableLines.length > 0">
                                                    <div class="table-responsive">
                                                        <table class="table table-striped">
                                                            <thead>
                                                                <tr>
                                                                    <th>MSISDN</th>
                                                                    <th>Operador</th>
                                                                    <th>Tipo Persona</th>
                                                                    <th>Tipo Identificación</th>
                                                                    <th>Número Documento</th>
                                                                    <th>Nombre</th>
                                                                    <th>Fecha Expedición</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr *ngFor="let linea of portableLines; let i = index">
                                                                    <td>{{ linea.numeroLinea }}
                                                                    </td>
                                                                    <td>{{ linea.operador }}
                                                                    </td>
                                                                    <td>{{ linea.tipoPersona }}
                                                                    </td>
                                                                    <td>{{
                                                                        linea.tipoIdentificacion
                                                                        }}
                                                                    </td>
                                                                    <td>{{ linea.numeroDocumento
                                                                        }}</td>
                                                                    <td>{{ linea.nombre }}</td>
                                                                    <td>{{ linea.fechaExpedicion
                                                                        }}</td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="tab-pane fade" id="devices_tab" role="tabpanel"
                                                aria-labelledby="tab3-tab">

                                                <div class="container"
                                                    *ngIf="newContract && newContract.contract && newContract.devices.length > 0">



                                                    <div class="row">
                                                        <div class="table-responsive">
                                                            <table class="table table-striped table-hover">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Equipo</th>
                                                                        <th>Cantidad</th>
                                                                        <th>Valor total</th>
                                                                        <th>Redención de Equipos</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr
                                                                        *ngFor="let equipo of newContract.devices; let i = index">
                                                                        <td>{{ equipo.equipo }}
                                                                        </td>
                                                                        <td>{{ equipo.cantidad
                                                                            }}</td>

                                                                        <td>{{
                                                                            (equipo.cantidad *
                                                                            equipo.valorEquipo * (1 -
                                                                            (equipo.porcentajeDescuento
                                                                            / 100))) | currency

                                                                            }}</td>
                                                                        <td>{{
                                                                            equipo.redencionEquipos
                                                                            }}
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>

                                                    </div>

                                                    <div class="col-md-12">
                                                        <div class="alert alert-info">
                                                            <div class="row">
                                                                <div class="col-8"><b>Valor Bolsa: </b>
                                                                </div>
                                                                <div class="col-4">{{
                                                                    newContract.contract.valorBolsa |
                                                                    currency }} </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-8"><b>Saldo:</b>
                                                                </div>
                                                                <div class="col-4">{{
                                                                    newContract.contract.saldo < 0 ? 0 :
                                                                        newContract.contract.saldo.toFixed(2) | currency
                                                                        }} </div>
                                                                </div>

                                                                <div class="row">
                                                                    <div class="col-8"><b>Valor NO
                                                                            Redimible:</b></div>
                                                                    <div class="col-4">{{
                                                                        newContract.contract.saldo > 0 ?
                                                                        newContract.contract.valorNoRedimible.toFixed(2)
                                                                        :
                                                                        (newContract.contract.valorNoRedimible
                                                                        + (-1 *
                                                                        newContract.contract.saldo)).toFixed(2)
                                                                        | currency }}</div>
                                                                </div>

                                                            </div>





                                                        </div>



                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>

                                    <div class="row g-2"></div>
                                </div>
                            </div>



                        </div>
                    </div>
                    <div class="card-footer text-end">
                        <div class="row">
                            <div class="col-9">
                                
                                

                            </div>

                            <div class="col-3">
                                <button type="button" class="btn btn-primary">Ejecutar</button>                          

                            </div>

                            <div class="col-3">
                                <button type="button" class="btn btn-primary">Reintentos</button>                          

                            </div>

                            <div class="col-3">
                                <button type="button" class="btn btn-primary">Modificar</button>
                            </div>

                        </div>


                    </div>

                </div>

            </div>
        </div>

    </div>